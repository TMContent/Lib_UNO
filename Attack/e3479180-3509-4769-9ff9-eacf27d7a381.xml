<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-1531967736" Content_Hash="-720422532">
  <Metadata>
    <Id>e3479180-3509-4769-9ff9-eacf27d7a381</Id>
    <Id_History>a89508a7-130f-4622-b167-10fdaeab5cf8,</Id_History>
    <Library_Id>c4b9cb6a-4561-4451-9b6c-4e59d73584f6</Library_Id>
    <Title>LDAP Injection Attack</Title>
    <Category>Input and Data Validation</Category>
    <Phase>Implementation</Phase>
    <Technology> Any</Technology>
    <Type>Attack</Type>
    <DirectLink>LDAP Injection Attack</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<br />
  <br />
  <h1>Applies To</h1>
  <p>Applications using LDAP.</p>
  <h1>Description</h1>
  <p>LDAP injection is a technique for exploiting applications that use input from users to query an LDAP directory. Lightweight Directory Access Protocol (LDAP) is a widely used protocol for accessing directory services. Directories provide a set of attributes about people that are organized in a hierarchal manner, for example the phone directory. </p>
  <p>In principle this is exactly the same attack as SQL or XML injection; the only difference is the query language used and the database accessed. Because directories are primarily used to maintain information about people, LDAP injection has the potential to view, modify, or remove personal information about anyone in the directory. The most common mistake is creating filter statements dynamically without validating user input.</p>
  <h1>Impact</h1>
  <ul>
    <li>Unintentional information disclosure <li>Elevation of privilege through manipulation of query results <li>Corruption of LDAP data store through manipulation of updates</li></li></li>
  </ul>
  <h1>Vulnerabilities</h1>
  <ul>
    <li>Building dynamic LDAP queries using untrusted input </li>
  </ul>
  <h1>Countermeasures</h1>
  <ul>
    <li>Untrusted input should be validated against an inclusion list before use (e.g., RegEx pattern, primitive type casting, domain constraint, etc.)</li>
  </ul>
  <h1>Example</h1>
  <p>
    <strong>Vulnerable Code:</strong>
  </p>
  <p>The following PHP code connects to an LDAP server on localhost and searches for records where the surname equals the value supplied by the user. </p>
  <pre>&lt;?php&amp;#36;ds=ldap_connect("localhost");<br /> if (&amp;#36;ds)<br /> &amp;#123;<br />    &amp;#36;ok=ldap_bind(&amp;#36;ds);<br /> // anonymously bind for read-only access<br />    &amp;#36;surname=&amp;#36;_GET&amp;#91;'surname'&amp;#93;;<br />    &amp;#36;filter = "(sn=" . &amp;#36;surname . ")";<br />    &amp;#36;sr=ldap_search(&amp;#36;ds, "o=My Company, c=US", &amp;#36;filter);<br />    &amp;#36;info = ldap_get_entries(&amp;#36;ds, &amp;#36;sr);<br />    echo "&lt;p&gt;There are " . &amp;#36;info&amp;#91;"count"&amp;#93; . " entries for that search:&lt;p&gt;";</pre>
  <pre>    for (&amp;#36;i=0; &amp;#36;i&lt;&amp;#36;info&amp;#91;"count"&amp;#93;; &amp;#36;i&amp;#43;&amp;#43;) &amp;#123;<br />        echo "common name: " . &amp;#36;info&amp;#91;&amp;#36;i&amp;#93;&amp;#91;"cn"&amp;#93;&amp;#91;0&amp;#93; . "&lt;br /&gt;";<br />        echo "telephone: " . &amp;#36;info&amp;#91;&amp;#36;i&amp;#93;&amp;#91;"telephoneNumber"&amp;#93;&amp;#91;0&amp;#93; . "&lt;br /&gt;";<br />        echo "email: " . &amp;#36;info&amp;#91;&amp;#36;i&amp;#93;&amp;#91;"mail"&amp;#93;&amp;#91;0&amp;#93; . "&lt;br /&gt;&lt;hr /&gt;";<br />    &amp;#125;</pre>
  <pre>    ldap_close(&amp;#36;ds);</pre>
  <pre>&amp;#125;<br /> else &amp;#123;<br />    echo "&lt;h4&gt;connection error&lt;/h4&gt;";&amp;#125;?&gt;</pre>
  <p>If this code is in index.php at teammentorexample.com then the following URL would return all records where surname is Smith.</p>
  <pre>http://teammentorexample.com/index.php?surname=Smith</pre>
  <p>
    <strong>Attack Example:</strong>
  </p>
  <p>Now suppose an attacker entered:</p>
  <pre>
    <strong>x)(&amp;#124;(cn=&amp;#42;</strong>
  </pre>
  <p>instead of Smith. That is, the attacker could do the following:</p>
  <pre>http://teammentorexample.com/index.php?surname=x)(&amp;#124;(cn=&amp;#42;</pre>
  <p>Examining a few lines of the above code reveals that this would return a list of everyone in the directory.</p>
  <pre>    &amp;#36;sirname=&amp;#36;_GET&amp;#91;'surname'&amp;#93;;<br />    // &amp;#36;surname = x)(&amp;#124;(cn=&amp;#42;)<br />    &amp;#36;filter = "(sn=" . &amp;#36;surname . ")";<br />    // &amp;#36;filter = (sn=x)(&amp;#124;cn=&amp;#42;)<br />     &amp;#36;sr=ldap_search(&amp;#36;ds, "o=My Company, c=US", &amp;#36;filter);<br />    // this reads: search My Companies directory for people<br />    //      having surname equal to x or anything<br /></pre>
  <h1>Additional Resources</h1>
  <ul>
    <li>For more information on LDAP Injection, see the <a href="http://www.owasp.org/index.php/Interpreter_Injection#LDAP_Injection">OWASP LDAP Injection</a> article. <li>For more information on LDAP, see the <a href="http://en.wikipedia.org/wiki/Ldap">Wikipedia LDAP</a> article. <li>For a detailed LDAP reference, see <a href="http://www.ietf.org/rfc/rfc2251.txt">RFC 2251</a>.</li></li></li>
  </ul>
  <h1>Related Items</h1>
  <ul>
    <li>
      <a href="/article/5c86d31c-18bf-45e8-9fd1-9214a285022e">Attack: SQL Injection Attack</a>
      <li>
        <a href="/article/e08f0f58-ccd3-4e52-8a43-51a4675d6119">Attack: AJAX Injection Attack</a>
        <li>
          <a href="/article/eaa90597-a420-410b-a7e7-2527dba65649">Attack: Server-Side Code Injection Attack</a>
          <li>
            <a href="/article/d2cd0955-4493-48de-81aa-c46f681fad0a">Attack: XML Injection Attack</a>
            <li>
              <a href="/article/875fb915-a91b-4190-b383-23dc81474136">Attack: Xpath-XQuery Attack</a>
              <li>
                <a href="/article/fb8f74de-9fbf-4c04-afa4-08f79fbf491f">Attack: Client-side Validation Attack</a>
                <li>
                  <a href="/article/946a5edb-e8f8-4365-8675-b8a5032c201b">Guideline: Validate All Data Passed Between Native and Java Code </a>
                  <li>
                    <a href="/article/f29fac90-c626-41d6-9184-acd6007696cf">Guideline: Validate Input for Length, Range, Format, and Type </a>
                    <li>
                      <a href="/article/40eea61e-c8bd-494a-b75d-c18c2074c752">Guideline: Validate Input from All Sources </a>
                      <li>
                        <a href="/article/9f21442f-2aee-4573-8be6-a5b51d9c89b8">Guideline: Do Not Rely on Client-Side Validation </a>
                        <li>
                          <a href="/article/88f49e05-f101-4764-b8e3-b31cd7507071">Guideline: Do Not Rely on Request Validation </a>
                        </li>
                      </li>
                    </li>
                  </li>
                </li>
              </li>
            </li>
          </li>
        </li>
      </li>
    </li>
  </ul>]]></Data>
  </Content>
</TeamMentor_Article>