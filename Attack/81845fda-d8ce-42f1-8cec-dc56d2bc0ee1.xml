<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-2143645654" Content_Hash="237349837">
  <Metadata>
    <Id>81845fda-d8ce-42f1-8cec-dc56d2bc0ee1</Id>
    <Id_History>7882e2b4-6b68-4d7c-a645-97b15b0e4fa1,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>Reflection Injection Attack</Title>
    <Category>Input and Data Validation</Category>
    <Phase>Implementation</Phase>
    <Technology> Any</Technology>
    <Type>Attack</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<br />
  <br />
  <h1>Applies To</h1>
  <p>.NET applications, Java applications, and applications written in any other language which supports reflection.</p>
  <h1>Description</h1>
  <p>Reflection is a programming technique provided by an API that let's you treat class definitions themselves as objects. It gives the programmer a way to view and modify class members such as constructors, methods, interfaces, and fields at runtime. This is often used for the of development tools such as class browsers or GUI designers. However, if untrusted user input is used to manipulate objects at runtime, injection is possible. Attackers may be able to view or modify which classes are used or even run arbitrary code. </p>
  <h1>Impact</h1>
  <ul>
    <li>Execution of arbitrary code <li>Bypass of security controls</li></li>
  </ul>
  <h1>Vulnerabilities</h1>
  <ul>
    <li>Failure to validate input <li>Validation of a library based solely on the name <li>Loading libraries based on external input</li></li></li>
  </ul>
  <h1>Countermeasures</h1>
  <ul>
    <li>Constrain input: Use vigorous whitelist style input checking of any input received from the user. <li>Signed Certificates: Use strongly signed assemblies only, only load a class if it passes this check.</li></li>
  </ul>
  <h1>Example</h1>
  <p>A common example of this attack occurs when an attacker can inject code to provide the name of a less secure class that implements the same interface as what was meant to be instantiated. The Java code below creates and uses an HTTP connection based on a user supplied string that defines the type. </p>
  <pre>import java.lang.reflect.&amp;#42;;<br />import java.net.&amp;#42;;<br />class ExampleReflection<br /> &amp;#123;<br />   public static void main(String&amp;#91;&amp;#93; args)<br /> &amp;#123;<br />&amp;#9;String mycon = "HttpsUrlConnection";<br />         // HttpsUrlConnection is a string provided by the user in some manner<br />      &amp;#9;URLConnection c = (URLConnection)createConnection(mycon);<br />        c.connect();<br />   &amp;#125;<br />   static Object createConnection(String name)<br /> &amp;#123;<br />      &amp;#9;Object object = null;<br />     &amp;#9;try &amp;#123;<br />        &amp;#9;Class classdef = Class.forName(name);<br />          &amp;#9;object = classdef.newInstance();<br />&amp;#9;&amp;#125;<br /> catch (InstantiationException e)<br /> &amp;#123;<br />          &amp;#9;System.out.println(e);<br />      &amp;#9;&amp;#125;<br /> catch<br /> (IllegalAccessException e)<br /> &amp;#123;<br />          &amp;#9;System.out.println(e);<br />      &amp;#9;&amp;#125;<br /> catch (ClassNotFoundException e)<br /> &amp;#123;<br />          &amp;#9;System.out.println(e);<br />    &amp;#9;&amp;#125;<br />      return object;   <br />&amp;#125;<br />&amp;#125;</pre>
  <p>Now suppose an attacker could inject "HttpUrlConnection" into the string mycon instead of "HttpsUrlConnection". Then instead of an SSL secured connection, an insecure connection will be created leaving the data in transit unprotected. The application does not know any different because both HttpUrlConnection and HttpsUrlConnection implement UrlConnection.</p>
  <h1>Additional Resources</h1>
  <ul>
    <li>For more information on Reflection Injection, see the <a href="http://www.owasp.org/index.php/Reflection_injection">OWASP Reflection Injection</a> article. <li>For more information on Java Reflection, see the <a href="http://java.sun.com/docs/books/tutorial/reflect/index.html">Java Reflection Documentation</a>. <li>For more information on .NET Reflection, see <a href="http://msdn.microsoft.com/msdnmag/issues/07/06/CLRInsideOut/default.aspx">Reflections on Reflection</a>.</li></li></li>
  </ul>
  <h1>Related Items</h1>
  <ul>
    <li>
      <a href="/article/2ea301c7-883f-4666-87fa-45f796f71ba4">Attack: Command Injection Attack</a>
      <li>
        <a href="/article/9f8d1872-4048-4df0-899c-38e0c7e81d79">Attack: Client-side Validation Attack</a>
        <li>
          <a href="/article/adf5df06-2b67-4e2a-ace2-6d7060e0bd95">Attack: Server-Side Code Injection Attack</a>
        </li>
      </li>
    </li>
  </ul>]]></Data>
  </Content>
</TeamMentor_Article>