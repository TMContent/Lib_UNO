<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="294350312" Content_Hash="-639980792">
  <Metadata>
    <Id>9605c5a0-bf2d-4a4e-b4b3-0b8f9690c732</Id>
    <Id_History>a48f1daa-3cb9-4594-9064-b8f81c225a6c,</Id_History>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>How to Implement An Integrity Check</Title>
    <Category>Cryptography</Category>
    <Phase>Implementation</Phase>
    <Technology>.NET 3.5</Technology>
    <Type>How To</Type>
    <DirectLink>How to Implement An Integrity Check</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority />
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Description</h1>
  <p>You can use integrity checking to verify that data sent via an unsecured communication channel has not been modified. You can implement integrity checks on your data with a data hash or a digital signature. A data hash alone does not ensure integrity because both the data and the hash could be modified by a malicious user. </p>
  <p>Use a digital signature or the <b>System.Security.Cryptography.HMACSHA1</b> hashing class to help ensure data integrity. An integrity check is performed by verifying that the hash value of the received data matches the hash value of the data that was sent. The Hash-based Message Authentication Code (HMAC) verifies that both the hashed data and the hash itself have not been altered. </p>
  <p>When you perform an integrity check with an HMAC, follow these guidelines: </p>
  <ul>
    <li>The sender and receiver must both have knowledge of a private key that will be used to calculate the HMAC. <li>Generate an HMAC from the data by using the <b>HMACSHA1 </b>class. <li>Send the data and the HMAC to the recipient. <li>Verify the integrity of received data by computing an HMAC on the data and comparing it to the HMAC sent. If the private key has not been stolen and the HMAC values match, you can be sure that the data has not been modified.</li></li></li></li>
  </ul>
  <p>The following code example shows how to compute an HMAC: </p>
  <pre>using System; using System.IO;using System.Security.Cryptography; <br />public class ComputeHMAC <br />&amp;#123;     <br />&amp;#9;public static void Main (string&amp;#91;&amp;#93; args)     <br />&amp;#9;&amp;#123;         <br />&amp;#9;&amp;#9;byte&amp;#91;&amp;#93; key = new byte&amp;#91;KEY_SIZE&amp;#93;;        <br />&amp;#9;&amp;#9;byte&amp;#91;&amp;#93; data = new byte&amp;#91;DATA_SIZE&amp;#93;;        <br />&amp;#9;&amp;#9;// Key should contain the value of the private shared key.        <br />&amp;#9;&amp;#9;HMACSHA1 hmac = new HMACSHA1(key);        <br />&amp;#9;&amp;#9;CryptoStream cs = new CryptoStream(Stream.Null, hmac,<br />&amp;#9;                                           CryptoStreamMode.Write);        <br />&amp;#9;&amp;#9;cs.Write(data, 0, data.Length);        <br />&amp;#9;&amp;#9;cs.Close();        <br />&amp;#9;&amp;#9;byte&amp;#91;&amp;#93; result = hmac.Hash;      <br />&amp;#9;&amp;#125;<br />&amp;#125;</pre>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>