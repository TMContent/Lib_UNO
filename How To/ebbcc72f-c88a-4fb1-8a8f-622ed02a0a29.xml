<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-269836981" Content_Hash="1403741919">
  <Metadata>
    <Id>ebbcc72f-c88a-4fb1-8a8f-622ed02a0a29</Id>
    <Id_History>ebbcc72f-c88a-4fb1-8a8f-622ed02a0a29,524d0637-f31b-4f0b-be3a-90b0d8409b56,</Id_History>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>How to Impersonate Programmatically In WCF</Title>
    <Category>Impersonation and Delegation</Category>
    <Phase>Implementation</Phase>
    <Technology>WCF 3.5</Technology>
    <Type>How To</Type>
    <DirectLink>How to Impersonate Programmatically In WCF</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Jason Taylor, Prashant Bansode, Carlos Farre, Madhu Sundararajan, Rob Boucher, Steve Gregersen</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>Microsoft&amp;#174; Windows Communication Foundation (WCF) 3.5 <li>Microsoft Visual Studio&amp;#174; 2008</li></li>
  </ul>
  <h1>Description</h1>
  <p>Programmatic impersonation allows you to impersonate on specific lines of code rather than the entire operation. This finer-grained approach to impersonation can reduce security risk, however be aware that it is easier to make a mistake during implementation that could leave your code impersonating at higher privilege in the event of an error. Use the using statement to revert impersonation automatically.</p>
  <p>To impersonate the original caller programmatically, you need to have access to Windows Identity of the original caller, calling into your WCF service. For this you need to configure your WCF service to require Windows Authentication. Programmatic impersonation allows you to impersonate on specific lines of code rather than the entire operation.</p>
  <p>Use the Impersonate method of the <strong>ServiceSecurityContext.Current.WindowsIdentity</strong> class, as shown here. </p>
  <pre>public string GetData(int value)<br />&amp;#123; <br /> using (ServiceSecurityContext.Current.WindowsIdentity.Impersonate())<br /> &amp;#123;<br />     // Execute under security context of the original caller<br /> &amp;#125;   <br />&amp;#125;</pre>
  <p>
    <strong>Important</strong>: Revert the impersonation when you are done, in the above example the using statement does it for you.</p>
  <h1>Additional Resources</h1>
  <ul>
    <li>For more information, see &amp;#8220;Delegation and Impersonation with WCF&amp;#8221; at <a href="http://msdn2.microsoft.com/en-us/library/ms730088.aspx">http://msdn2.microsoft.com/en-us/library/ms730088.aspx</a><li>For more information see &amp;#8220;How to Impersonate the Original Caller in WCF calling from Windows Forms&amp;#8221; at <a href="http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=How&amp;#37;20To&amp;#37;20-&amp;#37;20Impersonate&amp;#37;20the&amp;#37;20Original&amp;#37;20Caller&amp;#37;20in&amp;#37;20WCF&amp;#37;20calling&amp;#37;20from&amp;#37;20Windows&amp;#37;20Forms&amp;referringTitle=How&amp;#37;20Tos">http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=How&amp;#37;20To&amp;#37;20-&amp;#37;20Impersonate&amp;#37;20the&amp;#37;20Original&amp;#37;20Caller&amp;#37;20in&amp;#37;20WCF&amp;#37;20calling&amp;#37;20from&amp;#37;20Windows&amp;#37;20Forms&amp;referringTitle=How&amp;#37;20Tos</a><li>For more information see &amp;#8220;How to Impersonate the Original Caller in WCF calling from Web Application&amp;#8221; at <a href="http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=How&amp;#37;20To&amp;#37;20-&amp;#37;20Impersonate&amp;#37;20the&amp;#37;20Original&amp;#37;20Caller&amp;#37;20in&amp;#37;20WCF&amp;#37;20calling&amp;#37;20from&amp;#37;20Web&amp;#37;20Application&amp;referringTitle=How&amp;#37;20Tos">http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=How&amp;#37;20To&amp;#37;20-&amp;#37;20Impersonate&amp;#37;20the&amp;#37;20Original&amp;#37;20Caller&amp;#37;20in&amp;#37;20WCF&amp;#37;20calling&amp;#37;20from&amp;#37;20Web&amp;#37;20Application&amp;referringTitle=How&amp;#37;20Tos</a><li>For impersonation and delegation Q&amp;A, see the Impersonation/Delegation section of &amp;#8220;WCF 3.5 Questions and Answers&amp;#8220; at <a href="http://www.codeplex.com/WCFSecurityGuide/">http://www.codeplex.com/WCFSecurityGuide/</a><a href="http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=WCF&amp;#37;20Questions&amp;#37;20and&amp;#37;20Answers&amp;#37;20&amp;#37;28Q&amp;#37;26A&amp;#37;29&amp;referringTitle=Home"></a><a href="http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=WCF&amp;#37;20Questions&amp;#37;20and&amp;#37;20Answers&amp;#37;20&amp;#37;28Q&amp;#37;26A&amp;#37;29&amp;referringTitle=Home"></a></li></li></li></li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>