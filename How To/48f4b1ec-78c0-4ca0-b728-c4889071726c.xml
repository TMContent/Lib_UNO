<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="466910996" Content_Hash="-338994787">
  <Metadata>
    <Id>48f4b1ec-78c0-4ca0-b728-c4889071726c</Id>
    <Id_History>a17e5cd4-7dca-4fd3-9656-2ff0b22cf0f2,</Id_History>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>How to Impersonate the Original Caller Without Windows Authentication</Title>
    <Category>Impersonation and Delegation</Category>
    <Phase>Implementation</Phase>
    <Technology>WCF 3.5</Technology>
    <Type>How To</Type>
    <DirectLink>How to Impersonate the Original Caller Without Windows Authentication</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Jason Taylor, Prashant Bansode, Carlos Farre, Madhu Sundararajan, Rob Boucher, Steve Gregersen</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>Microsoft&amp;#174; Windows Communication Foundation (WCF) 3.5 <li>Microsoft Visual Studio&amp;#174; 2008</li></li>
  </ul>
  <h1>Description</h1>
  <p>When using non-windows authentication like Certificate Authentication or username authentication, if you need to impersonate the original caller (if it has windows account) or a service account you have following 2 options </p>
  <ol>
    <li>Using the S4U Kerberos extensions - For this you must grant your process account the "Act as part of the operating system" user right.<li>Using the <strong>LogonUser </strong>windows API - this needs to have access to the user credentials (username and password) - which increases the security risk of maintaining the user credentials in WCF Service.</li></li>
  </ol>
  <p>
    <strong>Note</strong>: S4U Kerberos extensions places your process within the trusted computing base (TCB) of the Web server, which makes your Web server process very highly privileged. Where possible, you should avoid this approach because an attacker who manages to inject code and compromise your Web application will have unrestricted capabilities on the local computer.</p>
  <h1>Additional Resources</h1>
  <ul>
    <li>For more information, see &amp;#8220;Delegation and Impersonation with WCF&amp;#8221; at <a href="http://msdn2.microsoft.com/en-us/library/ms730088.aspx">http://msdn2.microsoft.com/en-us/library/ms730088.aspx</a><li>For impersonation and delegation Q&amp;A, see the Impersonation/Delegation section of &amp;#8220;WCF 3.5 Questions and Answers&amp;#8220; at <a href="http://www.codeplex.com/WCFSecurityGuide">http://www.codeplex.com/WCFSecurityGuide</a></li></li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>