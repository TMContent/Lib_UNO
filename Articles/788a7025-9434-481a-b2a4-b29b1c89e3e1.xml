<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="0" Content_Hash="0">
  <Metadata>
    <Id>788a7025-9434-481a-b2a4-b29b1c89e3e1</Id>
    <Id_History>ec7c31a5-585d-4e20-bd2a-14ef29d51d98,</Id_History>
    <Library_Id>d9c2b53f-5b05-4152-be72-e79d72854707</Library_Id>
    <Title>Cross-Site Scripting (XSS)</Title>
    <Category>OWASP</Category>
    <Phase>Any</Phase>
    <Technology>Scala with Play Framework</Technology>
    <Type>Guideline</Type>
    <DirectLink>Cross-Site Scripting (XSS)</DirectLink>
    <Author />
    <Priority />
    <Status />
  </Metadata>
  <Content Sanitized="false" DataType="html">
    <Data><![CDATA[<h1>Applies to</h1>
  <p>Applications written using Scala and Play Framework 2.1.0+</p>
  <h1>Vulnerability Description</h1>
  <p />
  <p />
  <p>Browsers are capable of displaying HTML and executing JavaScript. If the application does not escape special characters in the input/output, and reflects user input as-is back to the browser, it is vulnerable to a Cross-Site Scripting (XSS) attack. Through XSS, an attacker can steal or manipulate customer session and 
cookies and use it to impersonate the valid user, execute malicious 
files, install Trojans, redirect a user to a malicious site, and so on.</p>
  <p>There are two types of XSS: non-persistent (or reflected) XSS, and persistent (or stored) XSS.</p>
  <p>
    <b>Non-Persistent XSS. </b>A non-persistent attack requires a user to visit a link specially crafted by the attacker. When the user visits the link, the crafted code will get executed by the user’s browser.&amp;nbsp;</p>
  <p>
    <b>Persistent XSS. </b>In a persistent attack, the code injected by the attacker will be stored in a secondary storage device (usually on a database). A persistent attack is more harmful than a non-persistent attack.&amp;nbsp;</p>
  <p />
  <p />
  <p />
  <p />
  <h1>How to Fix</h1>
  <p />
  <p />
  <p>By default, Play’s template engine prevents XSS vulnerabilities. Everything you write literally in a template is considered HTML by Play, and output is un-escaped. This HTML is always written by the template author, so it is considered safe. Other than the default HTML page contents, Play’s template engine automatically escapes strings by default. Still, as a best practice, always escape special characters before they are displayed to the user screens.</p>
  <p>a) When you really need to insert un-escaped HTML in your templates, use the&amp;nbsp;<font face="Courier New">raw()</font>&amp;nbsp;method or the&amp;nbsp;<font face="Courier New">HTML()&amp;nbsp;</font>method on the string or use a verbatim tag in raw HTML. But if the string comes from a user input, sanitize it first.<br />b) To set up a stricter escaping rule, edit the function <font face="Courier New">escape</font> in the Play framework source at location ~/framework/src/play/src/main/scala/play/api/templates/Templates.scala and then build the source again.&amp;nbsp;<br />Alternatively, if you are building from GitHub source, edit the file at location <a href="https://github.com/playframework/Play20/blob/master/framework/src/play/src/main/scala/play/api/templates/Templates.scala">https://github.com/playframework/Play20/blob/master/framework/src/play/src/main/scala/play/api/templates/Templates.scala</a>&amp;nbsp;and add in additional filtering rules before you build the source.<br />c) Set the <font face="Courier New">HttpOnly</font> flag in the cookie. This is an additional flag that is used to prevent an XSS exploit from gaining access to the session cookie. In XSS, an attacker commonly accesses the session cookie, and subsequently hijacks the victim’s session. Thus, the <font face="Courier New">HttpOnly</font> flag is a useful prevention mechanism. To enable the flag, enter the below command in the <font face="Courier New">application.conf </font>file:</p>
  <p>
    <font face="Courier New">application.session.httpOnly=true</font>
  </p>
  <p>By default this flag is set to <font face="Courier New">false</font>.&amp;nbsp; <b>Note</b>&amp;nbsp; If&amp;nbsp;<a href="https://github.com/playframework/Play20/blob/master/framework/src/play/src/main/scala/play/api/mvc/Http.scala">Cookie class</a>&amp;nbsp;is used, httpOnly is set to <font face="Courier New">true</font> by default and would be overridden only if explicitly set to <font face="Courier New">false</font>.</p>
  <p>For defense-in-depth, always sanitize user input via the <font face="Courier New"><a href="http://www.playframework.com/documentation/api/2.0/scala/play/api/templates/HtmlFormat$.html">HtmlFormat.escape()</a></font>&amp;nbsp;method. It creates a <font face="Courier New">safe(escaped)</font> HTML fragment.</p>
  <h1 style="margin: 0px; padding: 10px 0px 0px; font-size: 17px; font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: rgb(255, 255, 255);">Related Items</h1>
  <ul style="margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; background-color: rgb(255, 255, 255);">
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="c4fb3614-f35d-45db-b576-f99bb34de516" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Attack: AJAX Injection Attack</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="7088b485-e0de-4649-8c0e-1a9c40619436" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Attack: Command Injection Attack</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="c5688313-0255-461c-a978-423596d182db" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Guideline: Do Not Rely on Client Side Validation</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="af528b9a-af5f-49b8-a314-4578c0b31273" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Guideline: Validate Input from All Sources</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="b6795407-d01e-44ec-8aed-a440d388902b" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Guideline: Validate Input for Length, Range, Format, and Type</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="3b46e08b-1e8a-4dbf-b7bc-39a13c8afcbc" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Guideline: Encode All Output Data</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="5d296e90-a27c-424a-bfe1-5576490b50c2" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Guideline: Protect Session Cookies</a>
      </b>
    </li>
  </ul>]]></Data>
  </Content>
</TeamMentor_Article>