<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="0" Content_Hash="0">
  <Metadata>
    <Id>797231a0-0fc5-49f1-a11f-e5cee01e2c7b</Id>
    <Id_History>9b813c51-99be-472c-b14e-23616d4a0f55,</Id_History>
    <Library_Id>d9c2b53f-5b05-4152-be72-e79d72854707</Library_Id>
    <Title>Insecure Direct Object References</Title>
    <Category>OWASP</Category>
    <Phase>Any</Phase>
    <Technology>Scala with Play Framework</Technology>
    <Type>Vulnerability</Type>
    <DirectLink>Insecure Direct Object References</DirectLink>
    <Author />
    <Priority />
    <Status />
  </Metadata>
  <Content Sanitized="false" DataType="html">
    <Data><![CDATA[Description
  <p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">The presence of an actual object name or key within a URL is known as a direct object reference.
 Direct object references are inherently insecure. They often expose sensitive data, such as files, database entries, or personal information. If your application generates URL's that use direct object references, there is a chance that an attacker can bypass an authorization check for the target object. Thus, an attacker could use clues from a direct object reference to manipulate the URL and succeed in gaining access to an object. <br /></p><h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Impact</h2><p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">If per-user or per-session indirect object references are used, the attacker can manipulate the URL and gain access to sensitive files or other related information from the server.&amp;nbsp;</p><h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Countermeasures</h2><p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">Testers can easily manipulate parameter values to detect direct object reference flaws. Code analysis quickly shows whether authorization is properly verified.</p><p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">To prevent direct object
 reference vulnerabilities, use only indirect object references. Indirect object references restrict users to accessing resources for which they are explicitly authorized.&amp;nbsp; <br /></p><ul><li>Ensure that the object ID's and names are as random as possible in order to minimize the user's ability to predict them. <br /></li><li>Do not expose the actual object ID or name</li><li>Always verify that the user is authorized to access the requested resource.</li></ul><b>Use an Indirect Reference Map. </b>Indirect object references are best explained with an example. Consider a social networking web site that allows a user to view the contact information of his friends. The contact information is stored in a database. Consider that the user has friends with the following contact information: <br /><p style="font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17); font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><i>UID: 1234234513; NAME: Joe; EMAIL: joe@yahoo.com;</i><br /><i style="line-height: 1.5em;">UID: 1234123412; NAME: Brad; EMAIL: brad@gmail.com;</i><i><br /></i><i style="line-height: 1.5em;">UID: 4244324332; NAME: Jack; EMAIL: jack@hotmail.com;</i><i><br /></i><br />The database also contains users that are not friends of the user, such as:</p><p style="font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17); font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><i style="line-height: 1.5em;">UID: 43243544434; Name: Jill; EMAIL: jill@home.com;</i>&amp;nbsp;<br /><br />The web site should programmatically create an Indirect Reference Map (a reference table) before displaying options to the user. The map should not be available to the user, it should be used entirely on the back-end. It can look something like:<br /><br /><i>1943423 -&gt; 1234234513<br /><span style="line-height: 1.5em;">2345344 -&gt; 1234123412</span><br /><span style="line-height: 1.5em;">3453453 -&gt; 4244324332</span><br /></i><br />The web site can then provide links to the user to view the contact information of his friends, such as:&amp;nbsp;</p><p style="font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17); font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><i>http://socialnet.com/viewprofile?id=</i><i>1943423</i><i><br /></i><i style="line-height: 1.5em;">http://socialnet.com/viewprofile?id=</i><i>2345344</i><i><br /></i><i style="line-height: 1.5em;">http://socialnet.com/viewprofile?id=</i><i>3453453</i><font color="#ff0000"><br /></font><br />Note, that because the links use reference numbers instead of database keys, the user can view only the information for which he is authorized. An attempt to view Jill's profile by using her UID in the URL <i>http://socialnet.com/viewprofile?id=43243544434</i> will not work, because that is not the ID generated for her in the indirect reference map. Thus, indirect object references effectively limit user access to application data, especially in databases.<br /><br />In Play Framework, you can eliminate direct object references by means of temporary mappings using ESAPI numeric &amp; random mappings via <a href="http://owasp-esapi-java.googlecode.com/svn/trunk/src/main/java/org/owasp/esapi/AccessReferenceMap.java">AccessReferenceMaps,</a> which are&amp;nbsp; <font face="Courier New">IntegerAccessReferenceMap</font>&amp;nbsp; and&amp;nbsp; <font face="Courier New">RandomAccessReferenceMap</font> .<br /><br /><b>Verify user authentication and authorization.&amp;nbsp; </b>Using indirect object references minimizes an attacker's ability to predict the resource identifier, and reduces their ability to attack, but it does not completely mitigate the attack. If an attacker learns the indirect object ID -- such as from the browser history on a shared computer -- he can send a valid resource request to gain access. Thus, it is critical to check the userâ€™s authorization to confirm if he may access the requested resource. This is easier to implement via database-based validations as opposed to application code.<br /><br /><b>Every direct object reference from an untrusted source must first be verified with an access control check to ensure the user is authorized for the
 requested object. </b>In Play framework 2.1.0+,&amp;nbsp;<a href="https://github.com/schaloner/deadbolt-2">DeadBolt-2</a>&amp;nbsp;can be used as authorization system that defines the access rights to certain controller methods or parts of a view.&amp;nbsp;<a href="https://github.com/jaliss/securesocial">SecureSocial</a>&amp;nbsp;is the framework than can be used for verifying the authentication of the logged in user to access the restricted section/URL of the website.</p><p style="font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17); font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Refer to the following Guidelines to help prevent insecure direct object reference vulnerabilities:</p><ul style="margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="b7176093-9004-4b9f-8b6b-4a56c6e9cb87" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Require Authentication and Authorization for All Sensitive Pages</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="08b369bf-b2ff-47e1-92c7-11c8607fbe00" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Make Authentication and Authorization Policies Configurable</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="10a459c4-4a39-4325-b3a9-a3458ac43b0c" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Deny All Access by Default</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="be7b255c-ce4b-427b-8b02-66e78481179e" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Check Access Control Permissions When Referencing Objects</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="0cdb8ff4-a9f0-47d8-b32c-b72e2da858d9" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Use Indirect Object References</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="42892132-de71-41b9-8c35-8f8ee23cb758" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Partition the Application Between Public and Private Domains</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="52ea4336-7d99-47b3-bea2-2ac33da6e1a2" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Secure the Account Administration Functionality</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="4a62104f-8abf-4d1f-8959-04b59b6db3b4" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Automatically Lock Inactive User Accounts</a></b></li></ul><ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);"></ul><h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);"><br /></h2><h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Application Check</h2><p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">To check for adequate protection against this vulnerability, refer to the following Checklist Items:<span class="Apple-tab-span" style="white-space: pre;"></span></p><ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17); background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="001453f0-a647-4307-ad94-4077307f71a1" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">Authentication and Authorization Are Required for All Sensitive Pages</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="a1310a50-1c9f-49f1-ad3e-ae1002e51b00" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">Authentication and Authorization Policies Are Configurable</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="e118152a-8a32-455d-b8ee-4b5d4c66742e" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">All Access Is Denied by Default</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="b01e90c6-bf52-4db8-b2ce-2b5a89a40815" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">Access Control Permissions Are Checked When Referencing Objects</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="42ff8254-15b9-4e5c-af6e-0ea617354b4f" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">Indirect Object References Are Used</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="41a04d3f-0bb5-4904-bb28-134a109f9ce0" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">The Application Is Partitioned into Public and Private Domains</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="02b0be6c-99ed-4ff6-8805-8fc0a7402ae5" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">Account Administration Functionality Is Secured</a></b></li><li style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><a href="1a839a80-f801-4bcd-895b-a62cddac93bc" target="_blank" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153);">Inactive User Accounts Are Automatically Locked</a></b></li></ul><div><font color="#111111" face="Segoe UI, Helvetica Neue, Helvetica, Arial, sans-serif" size="2"><br /></font></div><ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);"></ul><h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Web-Based Training</h2><p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);"><a href="https://vulnerabilities.teammentor.net/article/279ad567-2b34-44ce-8e56-8d96770ba500" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153); font-weight: bold;">AWA 101 Fundamentals of Application Security</a></p><p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">This two-part course is ideal for security and development practitioners that want to understand software security risk and seek specific implementation guidance on how to build and deploy more secure software applications. It starts off describing why software security is critical and the risk that software vulnerabilities represent, and proceeds to lay the foundation for secure software development by presenting specific security controls and principles that development teams can implement immediately to reduce software risk.</p><h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Additional Resources</h2><ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);"><li style="margin: 0px; padding: 0px;">For more information about Insecure Direct Object references, please see&amp;nbsp;<a href="http://www.cisodesk.com/web-application-security/threats-mitigation/insecure-direct-object-references/">http://www.cisodesk.com/web-application-security/threats-mitigation/insecure-direct-object-references/</a></li></ul><p><br /></p><p><br /></p><p><br /></p><ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);"></ul>]]></Data>
  </Content>
</TeamMentor_Article>