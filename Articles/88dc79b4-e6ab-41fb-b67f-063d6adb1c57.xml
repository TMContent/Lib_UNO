<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="0" Content_Hash="0">
  <Metadata>
    <Id>88dc79b4-e6ab-41fb-b67f-063d6adb1c57</Id>
    <Id_History>97d074f6-98c1-4a3b-a6b5-e69aa7d4e852,</Id_History>
    <Library_Id>d9c2b53f-5b05-4152-be72-e79d72854707</Library_Id>
    <Title>Unvalidated Redirects and Forwards</Title>
    <Category>OWASP</Category>
    <Phase>Any</Phase>
    <Technology>Scala with Play Framework</Technology>
    <Type>Vulnerability</Type>
    <DirectLink>Unvalidated Redirects and Forwards</DirectLink>
    <Author />
    <Priority />
    <Status />
  </Metadata>
  <Content Sanitized="false" DataType="html">
    <Data><![CDATA[<h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Description</h2>
  <p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">An unvalidated redirect and forward occurs when an application uses user input as a source for redirection -- via a URL or a hidden parameter -- without validating the parameter. This allows a <i>phishing</i> attack: The attacker inputs a malicious link that causes the application to redirect to a fake site that appears legitimate, but is actually controlled by the attacker. The attacker can use the fake site to steal user credentials and information, or can design the site so that merely accessing it leads to a trojan infection. <br /></p>
  <p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">In some cases, unvalidated redirects and forwards may also allow an attacker to gain unauthorized access to sensitive resources by manipulating 
redirect or forward parameters (see <a href="81df542f-e8b5-47b4-90ac-15892276ed50">Failure to Restrict URL Access</a>).<br /></p>
  <h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Impact</h2>
  <ul>
    <li>Attackers can trick people into visiting fake sites that steal user credentials and information, or lead to trojan infections.&amp;nbsp;</li>
    <li>Attackers may gain unauthorized access to sensitive resources.<br /></li>
  </ul>
  <h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Countermeasures</h2>
  <p>
    <b>Validate all input:</b>
  </p>
  <ul>
    <li>Prevent user-supplied input from being passed to the redirect functions. <br /></li>
    <li>For the best defense, validate the redirect target URL after it is calculated, before the&amp;nbsp; <font face="Courier New">redirect</font>&amp;nbsp; function of Play Framework is called. This will ensure that the URL is valid and does not contain malicious content.&amp;nbsp;</li>
    <li>When the set of acceptable input objects, such as file names or URLs, is limited and known:&amp;nbsp; Use whitelist-style validation by creating a mapping from a set of fixed input values (such as numeric IDs) to the actual file names or URLs, and reject all other input. For example, ID 1 could map to&amp;nbsp; <font face="Courier New">inbox.txt</font> ,&amp;nbsp; and ID 2 could map to&amp;nbsp; <font face="Courier New">profile.txt</font>.&amp;nbsp; The&amp;nbsp; <a href="http://owasp-esapi-java.googlecode.com/svn/trunk_doc/latest/org/owasp/esapi/AccessReferenceMap.html">ESAPI AccessReferenceMap</a>&amp;nbsp;can be used for this purpose.</li>
  </ul>
  <p>
    <b>Secure all redirects:</b>
  </p>
  <ul>
    <li>In Play Framework 2.1.0+:&amp;nbsp; Whenever there is a redirect from a login page to a post login page, or if there is a redirect which needs to be secure, make use of 303 redirects via <a href="http://www.playframework.com/documentation/2.1.0/ScalaRouting">reverse routing</a> in Scala. The&amp;nbsp;<a href="http://www.playframework.com/documentation/api/2.0/scala/play/api/mvc/Results.html">results</a>&amp;nbsp;api can also be used for redirection. <br /></li>
    <li>When redirecting to external sites, always use an intermediate disclaimer page that provides the user with a clear warning that they are leaving your site.</li>
  </ul>
  <p>Refer to the following Guidelines to help implement properly validated redirects and forwards:</p>
  <ul style="margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; background-color: rgb(255, 255, 255);">
    <li style="margin: 0px; padding: 0px;">
      <b>
        <a href="93b69439-8607-4b3b-af6a-70afa775afd3">Do Not Use Redirects or Forwards if Possible</a>
      </b>
      <br />
      <b style="margin: 0px; padding: 0px;">
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="b12f2cc4-e6ee-4577-9b13-84763a721803" target="_blank" style="margin: 0px; padding: 0px;">Calculate Destinations of Redirects and Forwards Without User Input</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <a href="353bbdfb-3d1e-494f-978c-e581f128ed4a" target="_blank" style="margin: 0px; padding: 0px;">Use Mapping Values When Redirecting on User Input</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b style="margin: 0px; padding: 0px;">
        <font color="#000000">
          <a href="a9d0919d-9630-4cce-87b0-5861662dfd2a" target="_blank" style="margin: 0px; padding: 0px;">Validate Destinations of Redirects and Forwards</a>
        </font>
      </b>
    </li>
  </ul>
  <ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);">
  </ul>
  <h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Application Check<br /></h2>
  <p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">To check for adequate protection against this vulnerability, refer to the following Checklist Items:<span class="Apple-tab-span" style="white-space: pre;"></span></p>
  <ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17); background-color: rgb(255, 255, 255);">
    <li style="margin: 0px; padding: 0px;">
      <b>
        <a href="3df8ba30-ea80-426f-b30a-5737a601a206">Redirects and Forwards Are Not Used Unless Necessary</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b>
        <a href="29aab3c9-027a-4d80-9963-79ea6077a61d">Destinations of Redirects and Forwards Are Calculated Without User Input</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b>
        <a href="1a4d7984-11a7-4d95-9c48-3d44cc22800b">Mapping Values Are Used for Redirects and Forwards</a>
      </b>
    </li>
    <li style="margin: 0px; padding: 0px;">
      <b>
        <a href="3e73a590-557d-49d8-be77-09fdea2cb64c">Destinations of Redirects and Forwards Are Validated</a>
      </b>
    </li>
  </ul>
  <div>
    <font color="#111111" face="Segoe UI, Helvetica Neue, Helvetica, Arial, sans-serif" size="2">
      <br />
    </font>
  </div>
  <ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);">
  </ul>
  <h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Web-Based Training</h2>
  <p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">
    <a href="https://vulnerabilities.teammentor.net/article/279ad567-2b34-44ce-8e56-8d96770ba500" style="margin: 0px; padding: 0px; color: rgb(51, 51, 153); font-weight: bold;">AWA 101 Fundamentals of Application Security</a>
  </p>
  <p style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 0.5em 0px 1em; padding: 0px; line-height: 1.5em; color: rgb(17, 17, 17);">This two-part course is ideal for security and development practitioners that want to understand software security risk and seek specific implementation guidance on how to build and deploy more secure software applications. It starts off describing why software security is critical and the risk that software vulnerabilities represent, and proceeds to lay the foundation for secure software development by presenting specific security controls and principles that development teams can implement immediately to reduce software risk.</p>
  <h2 style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 15px; margin: 0px; padding: 0px; color: rgb(17, 17, 17);">Additional Resources</h2>
  <ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);">
    <li style="margin: 0px; padding: 0px;">For more information about Insecure Redirect and Forwards, please see&amp;nbsp;<a href="https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet">https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet</a></li>
  </ul>
  <p>
    <br />
  </p>
  <p>
    <br />
  </p>
  <p>
    <br />
  </p>
  <ul style="font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: small; margin: 10px 0px 10px 25px; padding: 0px 0px 0px 30px; color: rgb(17, 17, 17);">
  </ul>]]></Data>
  </Content>
</TeamMentor_Article>