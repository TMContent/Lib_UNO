<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-1516002632" Content_Hash="-90458594">
  <Metadata>
    <Id>a9c2c121-614c-4a3f-9b7c-f2cf57d6aa0b</Id>
    <Id_History>a9c2c121-614c-4a3f-9b7c-f2cf57d6aa0b,65475491-bd9d-4d45-a405-dfb1e9ae19a0,</Id_History>
    <Library_Id>be5273b1-d682-4361-99d9-6234f2d47eb7</Library_Id>
    <Title>Cross-Site Request Forgery (CSRF) Prevention Using Struts 2</Title>
    <Category>Session Management</Category>
    <Phase>Implementation</Phase>
    <Technology>Java</Technology>
    <Type>Code Example</Type>
    <DirectLink>Cross-Site Request Forgery (CSRF) Prevention Using Struts 2</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority />
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>Java <li>Struts 2</li></li>
  </ul>
  <h1>Summary</h1>
  <p>Perform CSRF prevention using Struts 2 within an application.</p>
  <h1>Objectives</h1>
  <p>CSRF prevention is a key security control for an application that protects the application and its users from CSRF attacks. This article will describe how to use the built-in mechanisms provided by Struts 2 to perform CSRF prevention.</p>
  <h1>Code Example</h1>
  <p>There is a standard model for CSRF prevention using Struts 2 that involves 3 basic steps</p>
  <ol>
    <li>
      <p>Update your interceptor stack to include the <em>tokenSessionInterceptor</em>, either including or excluding all methods (all are included here).</p>
      <pre>&lt;interceptor-stack name="myStack"&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;interceptor-ref name="defaultStack" /&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;interceptor-ref name="tokenSession"&gt;<br />&amp;nbsp;&lt;param name="includeMethods"&gt;&amp;#42;&lt;/param&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/interceptor-ref&gt;<br />&lt;/interceptor-stack&gt;</pre>
      <pre>&lt;default-interceptor-ref name="myStack" /&gt;</pre>
      <li>
        <p>Update your action configuration to include or exclude any methods that need or do not need CSRF protection.</p>
        <pre>&lt;action ...&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; ...<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;interceptor-ref name="tokenSession"&gt;<br />&amp;nbsp;&lt;param name="excludeMethods"&gt;searchBooks,getBook&lt;/param&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/interceptor-ref&gt;<br />&lt;/action&gt;</pre>
        <li>
          <p>Use <em>s:token</em> in your JSP form that requests the action.</p>
          <pre>&lt;s:form action="..."&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; ...<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;s:token /&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; ...<br />&lt;/s:form&gt;</pre>
        </li>
      </li>
    </li>
  </ol>
  <p>Using these 3 simple steps you can effectively have a session specific per user token used to validate that a request was submitted by a user intentionally.</p>
  <p>
    <strong>Note</strong>: There have been effective attacks against various CSRF prevention techniques including this token-based approach when an application has XSS vulnerabilities. Removing XSS is therefore viewed as a prerequisite activity for a complete CSRF prevention mechanism.</p>
  <p>In conclusion, CSRF prevention can function as a strong security control if used properly and applied thoroughly throughout the application. The Struts 2 framework provides a simple series of steps for accomplishing this task. </p>
  <h1>More Information</h1>
  <ul>
    <li>For more information about Token Interceptor, please see <a href="http://struts.apache.org/2.0.14/docs/token-interceptor.html">http://struts.apache.org/2.0.14/docs/token-interceptor.html</a><li>For more information about Cross-Site Request Forgery Prevention in Struts 2, please see <a href="http://struts.apache.org/2.0.14/docs/token-interceptor.html">http://struts.apache.org/2.0.14/docs/token-interceptor.html</a></li></li>
  </ul>
  <h1>Guideline</h1>
  <ul>
    <li>
      <a href="fdb460e6-5d18-4e35-a093-4b260155d79e">Include Unique Tokens in HTTP Requests</a>
    </li>
  </ul>]]></Data>
  </Content>
</TeamMentor_Article>