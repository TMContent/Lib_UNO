<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-430461688" Content_Hash="-43537313">
  <Metadata>
    <Id>a6a6bb8e-fbb7-4069-ae98-80cdb179db39</Id>
    <Id_History>a6a6bb8e-fbb7-4069-ae98-80cdb179db39,e4cee67e-802c-4d0f-9b12-5d22ebd36bcf,</Id_History>
    <Library_Id>be5273b1-d682-4361-99d9-6234f2d47eb7</Library_Id>
    <Title>If You Are Using Kerberos Authentication Or Delegation, Create an SPN</Title>
    <Category>Hardening</Category>
    <Phase>Implementation</Phase>
    <Technology>WCF 3.5</Technology>
    <Type>Guideline</Type>
    <DirectLink>If You Are Using Kerberos Authentication Or Delegation, Create an SPN</DirectLink>
    <Tag>WCF 3.5</Tag>
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Jason Taylor, Prashant Bansode, Carlos Farre, Madhu Sundararajan, Rob Boucher, Steve Gregersen</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>Microsoft® Windows Communication Foundation (WCF) 3.5 </li>
    <li>Microsoft Visual Studio® 2008</li>
  </ul>
  <h1>What to Do</h1>
  <p>If you are using Kerberos authentication, create a service principle name (SPN). </p>
  <h1>Why</h1>
  <p>Without an SPN, the Kerberos authentication will stop working when you switch from a machine account, such as Network Service, to a domain account.&nbsp; </p>
  <h1>How</h1>
  <p>Only SPNs can be configured for delegation in the Active Directory. In a production scenario using delegation, where you want to run the WCF service using a low-privileged custom domain account, you need to create an SPN for that account in order to enable delegation.</p>
  <p>To create an SPN for a domain account, run the Setspn tool from a command prompt as follows:</p>
  <pre>setspn -A HTTP/webservername domain\customAccountName <br />setspn -A HTTP/webservername.fullyqualifieddomainname domain\customAccountName </pre>
  <p>This creates an SPN for the custom domain account (domain\customAccountName) and associates the account with the HTTP service on the specified WCF server. By running the command twice as shown above, you can associate the account with the NetBIOS server name and the fully qualified domain name (FQDN) of the server. This ensures that the SPN is established correctly even if your environment does not consistently use FQDNs.<br /></p>
  <br />
  <hr />
  <p>Adapted from Microsoft patterns & practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>