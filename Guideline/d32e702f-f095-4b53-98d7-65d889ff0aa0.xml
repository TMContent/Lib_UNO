<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="1344360697" Content_Hash="-225389326">
  <Metadata>
    <Id>d32e702f-f095-4b53-98d7-65d889ff0aa0</Id>
    <Id_History>446a4d2f-1be0-4fb4-8152-51e39a54e3eb,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>Prevent SQL Injection</Title>
    <Category>Data Access</Category>
    <Phase>Implementation</Phase>
    <Technology>.NET 2.0</Technology>
    <Type>Guideline</Type>
    <DirectLink>Prevent SQL Injection</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Srinath Vasireddy, Ashish Babbar, Rico Mariani, and Alex Mackman</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>.NET 2.0</li>
  </ul>
  <h1>What to Do</h1>
  <p>To help prevent SQL injection, you should validate input and use parameterized stored procedures for data access. </p>
  <h1>Why</h1>
  <p>If you use the Parameters collection, SQL treats the input is&amp;nbsp;as a literal value rather then as&amp;nbsp;executable code. The Parameters collection can be used to enforce type and length constraints on input data. Values outside of the range trigger an exception. If&amp;nbsp;type-safe SQL parameters are not used, attackers might be able to execute&amp;nbsp;injection attacks&amp;nbsp;that are embedded in the&amp;nbsp;unfiltered input.</p>
  <h1>When</h1>
  <p>This guideline is applicable whenever there is an SQL statement that is built dynamically. It&amp;nbsp;is also appropriate&amp;nbsp;whenever stored procedures are utilized.</p>
  <h1>How</h1>
  <p>To use&amp;nbsp;type-safe SQL parameters, follow these steps:</p>
  <p>
    <strong>1. Determine the parameters in the SQL query or stored procedure being constructed.</strong> All parameters that result from user input or another untrusted source should be escaped, by specifying variable names in the query:</p>
  <blockquote>
    <p>SELECT * from&amp;nbsp;books WHERE&amp;nbsp;ISBN = '@isbn'</p>
  </blockquote>
  <p>
    <strong>2. Declare the explicit data types for each parameter in the SQL statement.</strong> aWhen executing the SQL statement, specify the data type and length for each parameter in the query:</p>
  <blockquote>
    <pre>myCommand.SelectCommand.Parameters.Add("@isbn", SqlDbType.VarChar, 10);<br /></pre>
  </blockquote>
  <p>
    <strong>3. Specify the value for each parameter.</strong> The untrusted input is then specified, so that it can be properly handled when the SQL statement executes:</p>
  <blockquote>
    <pre>myCommand.SelectCommand.Parameters["@isbn"].Value = '0494483923';</pre>
  </blockquote>
  <p>Additionally, use structured exception handling to catch errors that occur during database access, and prevent them from being returned to the client. A detailed error message may reveal valuable information such as the connection string, SQL server name, or table and database naming conventions. Attackers can use this information to construct more precise attacks. </p>
  <p>As an additional precaution, use a least privileged account to access the database, so that even if your application is compromised, the impact will be reduced.</p>
  <br />
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>