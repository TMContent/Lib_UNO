<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="659816188" Content_Hash="-294453815">
  <Metadata>
    <Id>bdff2308-96e1-4787-9162-a115d1366f76</Id>
    <Id_History>bdff2308-96e1-4787-9162-a115d1366f76,48923e8a-a6db-4b6b-96b6-9f72a0ab1f0f,</Id_History>
    <Library_Id>be5273b1-d682-4361-99d9-6234f2d47eb7</Library_Id>
    <Title>Block Protected Files from Being Retrieved</Title>
    <Category>Hardening</Category>
    <Phase>Deployment</Phase>
    <Technology>ASP.NET 3.5</Technology>
    <Type>Guideline</Type>
    <DirectLink>Block Protected Files from Being Retrieved</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>What to Do</h1>
  <p>Block access to important application and configuration files.</p>
  <h1>Why</h1>
  <p>Certain files, such as source code and important application and configuration files, should be accessed only by the application and not via direct HTTP access.</p>
  <h1>When</h1>
  <p>All web applications. </p>
  <h1>How</h1>
  <p>Use the following steps to block access to protected files:</p>
  <ol>
    <li>
      <p>
        <strong>Set appropriate permissions.</strong> Apply the appropriate filesystem permissions such that the configuration files can be only accessed by your application and its administrators.</p>
    </li>
    <li>
      <p>
        <strong>Use HttpForbiddenHandler.</strong> Use HttpForbiddenHandler to restrict HTTP access to configuration files. Follow these steps when configuring HttpForbiddenHandler to work with your application's custom extensions:</p>
      <ul>
        <li>
          <p>
            <strong>ISAPI filter</strong>: Map the ASP.NET ISAPI filter to your application's custom extension.</p>
          <ol>
            <li>Open the IIS management utility. </li>
            <li>Locate your application's virtual directory. </li>
            <li>Right click on your application and select <strong>Properties</strong>. </li>
            <li>Navigate to the <strong>Directory</strong> tab. </li>
            <li>Select <strong>Configuration</strong>. </li>
            <li>Locate the <strong>.aspx</strong> extension. </li>
            <li>Select <strong>Edit</strong>. </li>
            <li>Copy the Executable path. </li>
            <li>Select <strong>Cancel</strong>. </li>
            <li>Select <strong>Add</strong>. </li>
            <li>Paste the Executable path. </li>
            <li>Specify your application's custom extension. </li>
            <li>Select <strong>OK</strong> until you reach the IIS management utility.</li>
          </ol>
        </li>
        <li>
          <p>
            <strong>web.config</strong>: Add the following element in your application's web.config:</p>
          <pre>&lt;httpHandlers&gt;<br />  &lt;add path="*.myappextension" verb="*" type="System.Web.HttpForbiddenHandler" validate="true"/&gt;<br />&lt;/httpHandlers&gt;</pre>
        </li>
      </ul>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>MyLib is a paid subscription service for valuable software development content. MyLib stores all articles in PDF format. Because ASP.NET is not configured to block access to PDF files, MyLib's users can access the articles directly; therefore bypassing the purchase system and obtaining the articles for free.</p>
  <h1>Solution Example</h1>
  <p>MyLib is a paid subscription service for valuable software development content. MyLib stores all articles in PDF format. The developers have properly set the ASP.NET ISAPI filter and HttpForbiddenHandler component, blocking all direct access to MyLib's articles. Therefore all users must go through MyLib's payment system to obtain the requested articles.</p>
  <pre>&lt;httpHandlers&gt;<br />  &lt;add path="*.pdf" verb="*" type="System.Web.HttpForbiddenHandler" validate="true"/&gt;<br />&lt;/httpHandlers&gt;</pre>
  <h1>Additional Resources</h1>
  <ul>
    <li>To learn more about how to configure HttpForbiddenHandler, visit <a href="http://support.microsoft.com/kb/815152">HOW TO: Use ASP.NET to Protect File Types</a>.</li>
  </ul>
  <h1>Related Items</h1>
  <ul>
    <li>
      <a href="/article/fd675679-e8ad-40fc-bac4-d56fc440bc00">Guideline: Disable Directory Browsing</a>
    </li>
    <li>
      <a href="/article/7d83d845-cd2b-4067-bb4c-5fbb890b9c9e">Attack: Information Disclosure Attack</a>
    </li>
    <li>
      <a href="/article/b541ba53-6354-47be-9d89-8209b9807d93">Attack: Forceful Browsing Attack</a>
    </li>
    <li>
      <a href="/article/95f83af5-e312-42e5-a1ec-5da8eec34ce4">Checklist Item: Protected Files are Blocked From Being Retrieved</a>
    </li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>