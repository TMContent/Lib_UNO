<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="919753468" Content_Hash="981478981">
  <Metadata>
    <Id>78c11efd-5d38-46d6-9a36-a41144165e59</Id>
    <Id_History>78c11efd-5d38-46d6-9a36-a41144165e59,06dc3f2b-3835-4c3d-8fdc-7ba10419b42d,</Id_History>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>If You Use Windows Groups for Authorization, Use ASP.NET Role Provider with AspNetWindowsTokenRoleProvider</Title>
    <Category>Authorization</Category>
    <Phase>Implementation</Phase>
    <Technology>WCF 3.5</Technology>
    <Type>Guideline</Type>
    <DirectLink>If You Use Windows Groups for Authorization, Use ASP.NET Role Provider with AspNetWindowsTokenRoleProvider</DirectLink>
    <Tag>WCF 3.5</Tag>
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Jason Taylor, Prashant Bansode, Carlos Farre, Madhu Sundararajan, Rob Boucher, Steve Gregersen</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>Microsoft&#174; Windows Communication Foundation (WCF) 3.5 <li>Microsoft Visual Studio&#174; 2008</li></li>
  </ul>
  <h1>What to Do</h1>
  <p>If you are using windows groups for authorization, consider using the ASP.NET Role Provider with the AspNetWindowsTokenRoleProvider name. </p>
  <h1>Why</h1>
  <p>This allows you to separate the design of the authorization from the implementation inside your service. If you decide to change the role provider, it will not affect the code needed to perform the authorization.</p>
  <h1>When</h1>
  <p>Consider using this guideline when you are using windows groups for authorization.</p>
  <h1>How</h1>
  <p>The following configuration example shows how to configure AspNetWindowsTokenRoleProvider.</p>
  <blockquote>
    <pre>&lt;system.web&gt;<br />&#8230;<br />&lt;roleManager enabled="true"<br />             defaultProvider="AspNetWindowsTokenRoleProvider" /&gt;<br />&#8230;<br />&lt;/system.web&gt;</pre>
    <p>Configure the service behavior to use ASPNetRoles and the role provider.</p>
    <pre>&#8230;.<br />&lt;behaviors&gt;<br />    &lt;serviceBehaviors&gt;<br />        &lt;behavior name="BehaviorConfiguration"&gt;<br />            &lt;serviceAuthorization principalPermissionMode="UseAspNetRoles"<br />                roleProviderName=" AspNetWindowsTokenRoleProvider " /&gt;<br />            &lt;serviceMetadata /&gt;<br />        &lt;/behavior&gt;<br />    &lt;/serviceBehaviors&gt;<br />&lt;/behaviors&gt;<br />&#8230;.</pre>
  </blockquote>
  <p>Also consider using imperative checks using the role manager API instead of performing authorization checks with WindowsPrincipal.IsInrole. </p>
  <p>The following code shows how to perform the authorization check in code, using Role Manager API:</p>
  <blockquote>
    <pre>if (Roles.IsUserInRole(&#64;"accounting"))<br />&#123;<br />   //authorized<br />&#125;<br />else<br />&#123;<br />   //authorization failed<br />&#125;</pre>
  </blockquote>
  <h1>Additional Resources</h1>
  <ul>
    <li>For more information on authorization, see &#8220;Authorization&#8221; at <a href="http://msdn2.microsoft.com/en-us/library/ms733071.aspx">http://msdn2.microsoft.com/en-us/library/ms733071.aspx</a><li>For information on how to use the Role Manager , see &#8220;How To: Use Role Manager in ASP.NET 2.0&#8221;at <a href="http://msdn2.microsoft.com/en-us/library/ms998314.aspx">http://msdn2.microsoft.com/en-us/library/ms998314.aspx</a><li>For authorization Q&A, see the Authorization section of &#8220;WCF 3.5 Questions and Answers &#8220; at <a href="http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=WCF&#37;20Questions&#37;20and&#37;20Answers&#37;20&#37;28Q&#37;26A&#37;29&referringTitle=Home">http://www.codeplex.com/WCFSecurityGuide/Wiki/View.aspx?title=WCF&#37;20Questions&#37;20and&#37;20Answers&#37;20&#37;28Q&#37;26A&#37;29&referringTitle=Home</a></li></li></li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns & practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>