<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="257025944" Content_Hash="468169828">
  <Metadata>
    <Id>9c699256-89d7-4048-8bc0-9bd273999186</Id>
    <Id_History>a968d5da-d6c2-4993-8748-afb304191534,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>Use Windows Authentication to Connect to the SQL Server</Title>
    <Category>Session Management</Category>
    <Phase>Implementation</Phase>
    <Technology>ASP.NET 2.0</Technology>
    <Type>Guideline</Type>
    <DirectLink>Use Windows Authentication to Connect to the SQL Server</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Alex Mackman, Blaine Wastell, Prashant Bansode, Andy Wigley, Kishore Gopalan</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>ASP.NET 2.0 </li>
  </ul>
  <h1>What to Do</h1>
  <p>Use&amp;nbsp;Windows authentication when connecting to SQL Server&amp;nbsp;whenever possible, because they offer distinct security related advantages over other authentication&amp;nbsp;methods such as mirrored local accounts&amp;nbsp;and impersonation/delegation schemes. </p>
  <h1>Why</h1>
  <p>Domain accounts offer several advantages over mirrored local accounts:</p>
  <ul>
    <li>You can enforce Active Directory password policies. </li>
    <li>Active Directory provides a single identity store with a single set of management tools. You do not have to maintain a separate set of SQL accounts. </li>
    <li>No credentials are passed over the network during authentication and you do not need to embed user names and passwords in the database connection string. This means that malicious users or attackers cannot obtain the credentials either by monitoring the network or by viewing connection strings inside your configuration files. </li>
    <li>You benefit from centralized account management. User accounts are subject to normal account management security policies such as password expiration periods, minimum lengths, and account lockout after multiple invalid logon requests.</li>
  </ul>
  <p>Not using Windows authentication is less robust, since a seperate set of&amp;nbsp; access credentials need to be maintained in a seperate store, which significantly complictes the administration and account management tasks as the number of accounts grow.</p>
  <h1>When</h1>
  <p>Use Windows authentication whenever possible. When you use Windows authentication to connect to SQL Server, you use either Kerberos or NTLM authentication depending on the configuration of your servers and domain. You might not be able to use Windows authentication if: </p>
  <ul>
    <li>Your database client and database server are separated by a firewall which prevents Kerberos or NTLM authentication. </li>
    <li>Your application server and database server are in separate domains with no trust. </li>
  </ul>
  <p>In these situations, you can use either mirrored local accounts or Impersonation/Delegation, but mirrored local accounts is a better choice under most circumstances. </p>
  <h1>How</h1>
  <p>To connect to SQL Server using Windows authentication, perform the following steps:</p>
  <p>
    <strong>1. Configure a connection string.</strong> For ASP.NET 2.0 applications, you should store connection strings in the &lt;connectionStrings&gt; section of your application's Web.config file. The connection string used with Windows authentication must include either the Trusted_Connection=Yes attribute, or the equivalent attribute Integrated Security=SSPI:</p>
  <blockquote>
    <pre>&amp;nbsp;&lt;connectionStrings&gt;<br />&amp;nbsp; &lt;add name="MyLocalSQLServer" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionString="Initial Catalog=pubs;User Id=sa;Password=asdasd;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; data source=localhost;Integrated Security=SSPI;"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; providerName="System.Data.SqlClient"/&gt;<br />&lt;/connectionStrings&gt;</pre>
  </blockquote>
  <p>
    <strong>2. Encrypt the connection string.</strong> Even though database connection strings for Windows authentication do not contain usernames and passwords, you should still consider encrypting them in Web.config to reduce the possibility of disclosing server names and database names. </p>
  <blockquote>
    <p>To encrypt the connectionStrings section&amp;nbsp;with the Machine Store, run the following command from a .NET command prompt:</p>
    <pre>aspnet_regiis -pe "connectionStrings" -app "/MachineDPAPI" -prov "DataProtectionConfigurationProvider" </pre>
  </blockquote>
  <p>
    <strong>3. Configure SQL Server security.</strong> You need to create a SQL Server login for your application's service account, and grant restricted permissions to access your database. You should restrict access to specific database objects, such as stored procedures. </p>
  <p>
    <strong>4. Test security access.</strong> Test database access that appropriate database permissions are available. Just as important, test that permissions unneccessary to the application's operation are denied.&amp;nbsp;</p>
  <br />
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>