<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="1960021160" Content_Hash="1832837204">
  <Metadata>
    <Id>2c48bbd6-2677-4ab0-80df-57985b90bee4</Id>
    <Id_History>2c48bbd6-2677-4ab0-80df-57985b90bee4,2c30c4c6-5df3-480b-9145-23a13dd85729,</Id_History>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>Protect ASP.NET Session State</Title>
    <Category>Session Management</Category>
    <Phase>Deployment</Phase>
    <Technology>ASP.NET 3.5</Technology>
    <Type>Guideline</Type>
    <DirectLink>Protect ASP.NET Session State</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="html">
    <Data><![CDATA[<h1>What do Do</h1>
  <p>Ensure that ASP.NET session state is properly protected from sniffing and guessing attacks by changing default values, disabling unused services and protecting your out of process state service. Consider changing the session state port from the default value of 42424. If you choose to use Out-of-Process session state management protect it using the proper mechanisms. Finally, if the session state service is not used at all by your application, it should be disabled.</p>
  <h1>Why</h1>
  <p>Attackers often use known attack vectors to attack an application; changing or disabling these services can minimize the attack surface of the application. Attackers will often use port scanners as a first attempt to learn more about the application under attack, changing the port can impede their progress. Attackers may attack the Out-of-Process session state management server directly to gain access to the system. Attackers will use any avenue to gain access to the application so if session state is unnecessary in your application it should be turned off.</p>
  <h1>When</h1>
  <p>If your application uses the default session state port it is recommended that you change it. If your application uses Out-of-Process state service (mode=StateServer) the following recommendations should be used.</p>
  <h1>How</h1>
  <p>Use the following steps to properly protect your application's ASP.NET session state service:</p>
  <ol>
    <li>
      <p>
        <strong>Change the default session state port</strong>: Changing the default port for Out-of-Process state service will not allow the attacker to quickly discover where the state service resides.</p>
      <p>To avoid using the default, well-known port, you can change the port by editing the following registry key:</p>
      <pre>HKLM\SYSTEM\CurrentControlSet\Services\aspnet_state\Parameters </pre>
      <p>The port number is defined by the Port named value. If you change the port number in the registry, for example, to 45678, you must also change the connection string on the element, as follows: stateConnectionString="tcpip=127.0.0.1:45678"</p>
    </li>
    <li>
      <p>
        <strong>Properly secure the Out-of-Process session state management</strong>: Like all user accounts the state service should be created using the principle of lease privilege. In the case that the attacker gains access to the credentials of the state service we do not want to relinquish more control to the attacker than necessary.</p>
      <ul>
        <li>Use a least-privileged account to run the state service. By default, the state service runs using the Network Service local, least-privileged account. You should not need to change this configuration.</li>
        <li>Protect the session state communication channel. See <a href="/article/b070122f-f1d1-47da-a378-57f845d5db61">Encrypt Communication Links</a> for more information. </li>
        <li>Consider changing the default port. Using Step 1, change the default session state port. </li>
        <li>Encrypt the state connection string. See <a href="/article/faada3f5-3f50-42fc-b863-5058e3d848cb">Protect Sensitive Data Inside Configuration Files</a> for more information.</li>
      </ul>
    </li>
    <li>
      <p>
        <strong>Use the following steps to properly turn off the ASP.NET state service</strong>:</p>
      <ol>
        <li>Navigate to Administrative Tools -&gt; Internet Information Services. </li>
        <li>Select the appropriate instance of IIS that is associated with your application. </li>
        <li>Right-click on the IIS instance and select Properties. </li>
        <li>Select the Configuration option under the Home Directory tab. </li>
        <li>Navigate to the Options tab. </li>
        <li>Uncheck the "Enable session state" option. </li>
        <li>Press the OK button.</li>
      </ol>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>
    <strong>Consider the following problem if you are using the default port for session state</strong>
  </p>
  <p>MyApp is a financial application that utilizes ASP.NET state service. Because the ASP.NET State Server is running with its default port configuration, it would be easy for a skilled attacker to discover and attack the service. </p>
  <p>
    <strong>Consider the following problem if your application does not require the session state</strong>
  </p>
  <p>MyApp is a monitoring tool. Although it does not require the ASP.NET state service, its administrators have not disabled the service; therefore allowing a skilled attacker to compromise the application through the ASP.NET state service.</p>
  <h1>Solution Example</h1>
  <p>
    <strong>If the default port is changed</strong>
  </p>
  <p>MyApp is a financial application that utilizes ASP.NET state service. Because the ASP.NET State Server is running with a custom port configuration, it would be difficult for a skilled attacker to discover and attack the service. </p>
  <p>
    <strong>If the session state service is turned off</strong>
  </p>
  <p>MyApp is a monitoring tool. It does not require the ASP.NET state service and its administrators have disabled the service. Therefore a skilled attacker must find security vulnerabilities with MyApp or any of its components before compromising the application.</p>
  <h1>Additional Resources</h1>
  <ul>
    <li>To learn more about configuring the ASP.NET State Service, visit: <a href="http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/0d9dc063-dc1a-46be-8e84-f05dbb402221.mspx">Configure the State Service on the ASP.NET State Server</a>. </li>
    <li>To learn more about configuring Out-of-Process State Service, see: <a href="http://technet2.microsoft.com/WindowsServer/en/library/17866624-359b-4fbf-8a3a-05fb13dee6811033.mspx">Configuring Out-of-Process Session State with the ASP.NET State Service</a>. </li>
    <li>For more information about securing your ASP.NET web application, see: <a href="http://msdn2.microsoft.com/en-us/library/aa302435.aspx#c19618429_013">Securing Your ASP.NET Application and Web Services</a>.</li>
  </ul>
  <h1>Related Items</h1>
  <ul>
    <li>
      <a href="/article/b070122f-f1d1-47da-a378-57f845d5db61">Guideline: Encrypt Communication Links </a>
    </li>
    <li>
      <a href="/article/faada3f5-3f50-42fc-b863-5058e3d848cb">Guideline: Protect Sensitive Data Inside Configuration Files </a>
    </li>
    <li>
      <a href="/article/254ddab5-ecd2-4e05-a2b0-861e970bc0d9">Guideline: Protect Session Cookies </a>
    </li>
    <li>
      <a href="/article/fab1733c-61d7-46a8-88c6-2617a643c0d9">Guideline: Use Least Privileged Accounts for Database Access </a>
    </li>
    <li>
      <a href="/article/7d83d845-cd2b-4067-bb4c-5fbb890b9c9e">Attack: Information Disclosure Attack</a>
    </li>
    <li>
      <a href="/article/6a219806-df28-4c00-bc2d-c2ce4c721b7e">Attack: Trust Relationship Attack</a>
    </li>
    <li>
      <a href="/article/4891b0a0-9843-463c-9d5e-addc3804bdde">Checklist Item: ASP.NET Session State is Protected </a>
    </li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance. </p>]]></Data>
  </Content>
</TeamMentor_Article>