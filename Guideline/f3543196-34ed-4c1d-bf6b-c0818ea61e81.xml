<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-1065847996" Content_Hash="-991503172">
  <Metadata>
    <Id>f3543196-34ed-4c1d-bf6b-c0818ea61e81</Id>
    <Id_History>f65ae126-8b14-42c9-8833-17a04239987d,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>Avoid Propagating ADO.NET Exceptions to Users</Title>
    <Category>Error and Exception Management</Category>
    <Phase>Implementation</Phase>
    <Technology>ADO.NET 2.0</Technology>
    <Type>Guideline</Type>
    <DirectLink>Avoid Propagating ADO.NET Exceptions to Users</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Alex Mackman, Blaine Wastell, Prashant Bansode, Chaitanya Bijwe</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>ADO.NET 2.0</li>
  </ul>
  <h1>What to Do</h1>
  <p>Use <b>try</b>/<b>catch</b> blocks to trap exceptions on the server, log appropriate details for subsequent diagnostics, and return an appropriate error message to the user. Display only generic information. It is usually enough for users to know that an error has occurred and the operation did not succeed, and to have a failure error code that they can report to a help desk.</p>
  <h1>Why</h1>
  <p>prevent ADO.NET exception details from being displayed to your application users. ADO.NET exceptions include many details that are useful to an attacker, including database server names, database names, table names, and so on.</p>
  <h1>When</h1>
  <p>This is an important guideline and should be followed all the time.</p>
  <h1>How</h1>
  <p>One approach is to catch ADO.NET exceptions on the server and then propagate a custom exception object from your data access code, as shown in the following example.</p>
  <pre>// Data access method<br />public string RetrieveProductName(int productID)<br />{<br />&amp;nbsp; ...<br />&amp;nbsp; try<br />&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; // Open database connection and perform data access<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&amp;nbsp; <br />&amp;nbsp; }<br />&amp;nbsp; catch (SqlException sqlex)<br />&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; // Log exception details on the server<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; ...<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; // Re-throw a new more relevant exception <br />&amp;nbsp;&amp;nbsp;&amp;nbsp; throw new DataAccessException( <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; "Failed to retrieve product information for product ID: " +<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ProductID.ToString());,<br />&amp;nbsp; }<br />&amp;nbsp; finally<br />&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; if(conn != null) <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; conn.Close(); // Ensures connection is closed<br />&amp;nbsp; }<br />}  </pre>
  <p>Note that when ADO.NET data access code generates a database exception, the abstract <b>System.Data.Common.DbException</b> is thrown. The actual type of exception generated by ADO.NET depends on the data provider. For example, the exception type could be any of the following: </p>
  <ul>
    <li>
      <b>System.Data.Odbc.OdbcException</b>
    </li>
    <li>
      <b>System.Data.OleDb.OleDbException</b>
    </li>
    <li>
      <b>System.Data.OracleClient.OracleException</b>
    </li>
    <li>
      <b>System.Data.SqlClient.SqlException</b>
    </li>
  </ul>
  <blockquote>
    <b>Note</b>&amp;nbsp;&amp;nbsp;&amp;nbsp;If you are writing provider independent code, catch the <b>DBException</b> type. Otherwise catch one of the provider specific exception types listed above, depending on the provider you are using.</blockquote>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>