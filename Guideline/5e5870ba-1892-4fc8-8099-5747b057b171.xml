<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="1304705119" Content_Hash="-836943686">
  <Metadata>
    <Id>5e5870ba-1892-4fc8-8099-5747b057b171</Id>
    <Id_History>1e19fb03-817e-4bfa-a625-e863bc9864b5,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>Use Delay Signing Where Appropriate</Title>
    <Category>Strong Naming and Signing </Category>
    <Phase>Deployment</Phase>
    <Technology>.NET 2.0</Technology>
    <Type>Guideline</Type>
    <DirectLink>Use Delay Signing Where Appropriate</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Srinath Vasireddy, Ashish Babbar, Rico Mariani, and Alex Mackman</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>.NET 2.0</li>
  </ul>
  <h1>What to Do</h1>
  <p>Use delay signing where appropriate, when you use delay signing, distribute your public key in a .snk file that just contains the public key. Then, use the -<b>keyfile</b> compiler switch while you delay-sign the assemblies, or continue to use the <b>AssemblyKeyFile</b> attribute if you have existing .NET 1.x code that uses this attribute.</p>
  <h1>Why</h1>
  <p>Delay signing places the public key in the assembly, which means that it is available as evidence to code access security policy, but the assembly is not signed. From a security perspective, delay signing has two main advantages: </p>
  <ul>
    <li>The private key used to sign the assembly and create its digital signature is held securely in a central location. The key is accessible to only a few trusted individuals. As a result, the chance of the private key being compromised is significantly reduced. </li>
    <li>A single public key, which can be used to represent the development organization or publisher of the software, is used by all members of the development team, instead of each developer using his or her own public, private key pair, typically generated by the <b>sn -k</b> command.</li>
  </ul>
  <h1>When</h1>
  <p>You should consider using delay signing when there are more than a few developers on your projects and/or you have a daily build process that allows you to easily sign assemblies generated from your daily build. Even if you do not meet either of these conditions, you should consider using delay signing if your private key is extremely sensitive; for example, because you have made trust decisions based on your private key across the thousands of desktops in your enterprise.</p>
  <h1>How</h1>
  <h2>Creating a Public Key File for Delay Signing</h2>
  <p>When you use delay signing, distribute your public key in a .snk file that just contains the public key. Then, use the -<b>keyfile</b> compiler switch while you delay-sign the assemblies, or continue to use the <b>AssemblyKeyFile</b> attribute if you have existing .NET 1.x code that uses this attribute.</p>
  <p>The signing authority performs the following procedure to create a public key file that developers can use to delay sign their assemblies.</p>
  <p>
    <b>To Create a Public Key File for Delay Signing</b>
  </p>
  <ol>
    <li>Create a key pair for your organization. <p><b>sn.exe -k keypair.snk</b></p></li>
    <li>Extract the public key from the key pair file. <p><b>sn -p keypair.snk publickey.snk</b></p></li>
    <li>Secure Keypair.snk, which contains both the private and public keys. For example, put it on a compact disc or other hardware device, such as a smart card, and physically secure it. </li>
    <li>Make Publickey.snk available to all developers. For example, put it on a network share.</li>
  </ol>
  <h2>Delay Signing an Assembly</h2>
  <p>This procedure is performed by developers.</p>
  <p>
    <b>To Delay Sign an Assembly</b>
  </p>
  <ol>
    <li>In Visual Studio .NET 2005, display the project properties. </li>
    <li>Click the <b>Signing</b> tab, and select the <b>Sign the assembly</b> and <b>Delay sign only</b> check boxes. </li>
    <li>In the <b>Choose a strong name key file:</b> drop-down box, select &lt;<b>BrowseÂ…</b>&gt;. </li>
    <li>In the file selection dialog box, browse to the public key (.snk) and click <b>OK</b>.<b></b></li>
    <li>Build your assembly. The complier will build a strong named assembly signed using the public key from the selected key pair (.snk) file. <blockquote><b>Note</b>&amp;nbsp;&amp;nbsp;&amp;nbsp;A delay signed project will not run and cannot be debugged. You can, however, use the Strong Name tool (Sn.exe) with the <b>-Vr</b> option to skip verification during development.</blockquote></li>
    <li>The delay signing process and the absence of an assembly signature means that the assembly will fail verification at load time. To work around this, use the following commands on development and test computers. <ul><li>To disable verification for a specific assembly, use the following command. <p><b>sn -Vr assembly.dll</b></p></li><li>To disable verification for all assemblies with a particular public key, use the following command. <p><b>sn -Vr *,publickeytoken</b></p></li><li>To extract the public key and key token (a truncated hash of the public key), use the following command. <p><b>sn -Tp assembly.dll</b></p></li></ul><blockquote><b>Note</b>&amp;nbsp;&amp;nbsp;&amp;nbsp;Use an uppercase <b>-T</b> switch.<b></b></blockquote></li>
    <li>To fully complete the signing process and create a digital signature to make the assembly tamper proof, execute the following command. This requires the private key, and as a result the operation is normally performed as part of the formal build/release process. The following command uses key pair contained in the Keypair.snk file to re-sign an assembly called Assembly.dll with a strong name. <p><b>sn -R assembly.dll keypair.snk</b></p></li>
  </ol>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>