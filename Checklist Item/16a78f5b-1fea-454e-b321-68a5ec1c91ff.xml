<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-1094707045" Content_Hash="-455895611">
  <Metadata>
    <Id>16a78f5b-1fea-454e-b321-68a5ec1c91ff</Id>
    <Id_History>4cbfd581-2f86-4dc5-9b66-20e837afb564,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>User Management Events Are Logged</Title>
    <Category>Auditing and Logging</Category>
    <Phase>Implementation</Phase>
    <Technology>ASP.NET 2.0</Technology>
    <Type>Checklist Item</Type>
    <DirectLink>User Management Events Are Logged</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Alex Mackman, Blaine Wastell, Prashant Bansode, Andy Wigley, Kishore Gopalan</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>ASP.NET 2.0</li>
  </ul>
  <h1>What to Check For</h1>
  <p>Check to ensure your application is instrumented for all user management events, including authentication successes and failures, password resets, password&amp;nbsp;changes, and account lockouts.</p>
  <h1>Why</h1>
  <p>Instrumenting for user management events&amp;nbsp;helps you to detect and react to potentially suspicious behavior.&amp;nbsp; It also enables you to gather operations data; for example, to track who is accessing your application and when user account passwords need to be reset. </p>
  <h1>How to Check</h1>
  <p>ASP.NET health monitoring will log many user management events by default.&amp;nbsp; Use the following steps to ensure user management events are being logged for your application:</p>
  <p>
    <strong>1. Check to ensure that ASP.NET health monitoring is being used by your application</strong>
  </p>
  <p>Health Monitoring is turned on by default in the machine level Web.Config file:</p>
  <pre>&lt;healthMonitoring heartbeatInterval="0" enabled="true"&gt;<br />  &lt;bufferModes/&gt;<br />  &lt;providers/&gt;<br />  &lt;profiles/&gt;<br />  &lt;rules/&gt;<br />  &lt;eventMappings/&gt;<br />&lt;/healthMonitoring&gt;</pre>
  <p>If the Enabled attribute is set to false in your machine or application level config file, then health monitoring has been turned off.&amp;nbsp; </p>
  <p>
    <strong>2. Check to ensure health monitoring rules are enabled</strong>
  </p>
  <p>By default the rules element is configured so that all errors and failure audits are logged:</p>
  <pre>&lt;rules&gt;<br /> &lt;add name="All Errors Default" eventName="All Errors" provider="EventLogProvider"<br />      profile="Default" minInstances="1" maxLimit="Infinite"<br />       minInterval="00:01:00" custom="" /&gt;<br /> &lt;add name="Failure Audits Default" eventName="Failure Audits"<br />      provider="EventLogProvider" profile="Default" minInstances="1"<br />      maxLimit="Infinite" minInterval="00:01:00" custom="" /&gt;<br />&lt;/rules&gt;</pre>
  <p>If there are no rules in the rules element, then health monitoring will not log any events.</p>
  <p>
    <strong>3. Check for additional non-default user management events </strong>
  </p>
  <p>The following events are not logged by default but can be turned on for additional information:</p>
  <strong>Forms Authentication Events</strong>
  <p />For additional forms authentication information, log the following events: <ul><li><b>AuditFormsAuthenticationSuccess</b> (code 4001). This is used to maintain audit trail of successful forms authentication, which can then be retraced if the system is compromised, when using forms authentication classes. </li><li><b>AuditMembershipAuthenticationSuccess</b> (code 4002). This is used to maintain audit trail of successful authentications in the ASP.NET membership system, which can then be retraced if the system is compromised, when using the membership feature. </li></ul><strong>Authorization Events</strong><p />To provide additional authorization information, log the following events: <ul><li><b>AuditFileAuthorizationSuccess</b> (code 4004). This is used to maintain an audit trail, which can then be retraced to identify all successful file accesses by an attacker if the system is compromised. </li><li><b>AuditUrlAuthorizationSuccess</b> (code 4003). This is used to maintain an audit trail, which can then be retraced to identify all successful URL and path accesses by an attacker if the system is compromised. </li></ul><h1>How to Fix</h1><p>Instrument your application and monitor user management events such as password resets, password changes, account lockout, user registration, and authentication events. Doing this helps you to detect and react to potentially suspicious behavior. It also enables you to gather operations data; for example, to track who is accessing your application and when user account passwords need to be reset.</p><p>By default, ASP.NET health monitoring records all <b>WebFailureAuditEvents</b>, which ASP.NET raises when user authentication fails in forms authentication with the membership system. ASP.NET also raises a <b>WebFailureAuditEvent</b> when authorization is not granted to a resource protected by file authorization and URL authorization.</p><p><strong>Note: </strong>If you are using integrity checks to ensure data from the client has not been tampered with, you can use health monitoring to log any instances of tampered data.&amp;nbsp; <br /></p><h1>Problem Example</h1><p>An ASP.NET application has turned off Health Monitoring and is not logging user management events:</p><pre>&lt;healthMonitoring heartbeatInterval="0" enabled="false"&gt;</pre><p>An malicous attacker is trying to brute force their way into the application through use of a dictionary attack on forms authentication. Since forms authentication failures are not logged, the attack is not detected until its too late and the exploit has succeeded.</p><h1>Solution Example</h1><p>An ASP.NET application has left Health Monitoring on:</p><pre>&lt;healthMonitoring heartbeatInterval="0" enabled="false"&gt;</pre><p>And has left default event logging on:</p><pre>&lt;rules&gt;<br />&lt;add name="All Errors Default" eventName="All Errors" provider="EventLogProvider"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; profile="Default" minInstances="1" maxLimit="Infinite" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; minInterval="00:01:00" custom="" /&gt;<br />&lt;add name="Failure Audits Default" eventName="Failure Audits"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; provider="EventLogProvider" profile="Default" minInstances="1"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; maxLimit="Infinite" minInterval="00:01:00" custom="" /&gt;<br />&lt;/rules&gt;</pre><p>An malicous attacker is trying to brute force their way into the application through use of a dictionary attack on forms authentication. Since forms authentication failures are logged, the attack is detected and prevented before the attacker is able to break in.</p><hr /><p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>