<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="1654243815" Content_Hash="1050071615">
  <Metadata>
    <Id>819c43d6-9acc-4efa-a247-f2cbb2800b7b</Id>
    <Id_History>587a67f0-39ef-489e-884e-902a45abff50,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>Query Strings Do Not Contain Server Secrets</Title>
    <Category>Input and Data Validation</Category>
    <Phase>Implementation</Phase>
    <Technology>ASP.NET 2.0</Technology>
    <Type>Checklist Item</Type>
    <DirectLink>Query Strings Do Not Contain Server Secrets</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Alex Mackman, Blaine Wastell, Prashant Bansode, Andy Wigley, Kishore Gopalan</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>ASP.NET 2.0</li>
  </ul>
  <h1>What to Check For</h1>
  <p>Check to ensure that sensitive information is not being transmitted between client and server through a query string.</p>
  <h1>Why</h1>
  <p>Sensitive data in the query string may be logged by web proxies, and will also appear in the user's browser history and in your own web server logs.&amp;nbsp; Additionally, if sensitive content is being sent through the user, the query string does not offer an easy way of protecting the content from user reading or tampering. </p>
  <h1>How to Check</h1>
  <p>Use the following steps to check for this problem:</p>
  <p>
    <strong>1. Identify sensitive information used by your application</strong>
  </p>
  <p>Examples of sensitive data include:</p>
  <ul>
    <li>
      <span>User Credentials</span>
    </li>
    <li>
      <span>Social Security number or other identifying information</span>
    </li>
    <li>
      <span>Credit card numbers or other financial information</span>
    </li>
    <li>
      <span>Health information</span>
    </li>
    <li>
      <span>Private keys or other data that could be used to decrypt encrypted information</span>
    </li>
    <li>
      <span>System or application information that can be used to more effectively attack the application</span>
    </li>
  </ul>
  <p>
    <span>
      <strong>2. Review how sensitive data is passed between client and server</strong>
    </span>
  </p>
  <p>
    <span>The most common mechanisms for communicating and maintaining sensitive information is:</span>
  </p>
  <ul>
    <li>
      <span>Session State</span>
    </li>
    <li>
      <span>HTTP POST</span>
    </li>
    <li>
      <span>ViewState</span>
    </li>
    <li>
      <span>HTTP GET, in the query string</span>
    </li>
  </ul>
  <p>
    <span>
      <strong>Session State</strong>
    </span>
  </p>
  <p>
    <span>Session State is an acceptable mechanism for maintaining sensitive information on the server during a user session.&amp;nbsp; If your application is using session state you'll see code similar to:</span>
  </p>
  <span>
    <blockquote>
      <pre>Session["SessionVarName"] = SensitiveObject.SensitiveData;</pre>
    </blockquote>
  </span>
  <p>
    <span>
      <strong>HTTP POST</strong>
    </span>
  </p>
  <p>
    <span>Sending sensitive information in&amp;nbsp;an HTTP POST form submit is an acceptable mechanism for transmitting the data to the server. Check to ensure the form submit is over SSL to ensure the information is protected on the wire.</span>
  </p>
  <p>
    <span>
      <strong>ViewState</strong>
    </span>
  </p>
  <p>
    <span>ViewState can be used to store sensitive information if ViewStateEncryption is used.&amp;nbsp; By default an HMAC integrity check is applied to the ViewState and SSL can protect the sensitive information over the wire.&amp;nbsp; ViewStateEncryption ensures the confidentiality of the sensitive information on the local machine. To check whether ViewState encryption is used properly, see ChecklistItem: <a name="View_State_is_Encrypted_if_it_Does_Cont">View State is Encrypted if it Does Contain Sensitive Data</a>.&amp;nbsp; </span>
  </p>
  <p>
    <span>
      <strong>HTTP GET in the query string</strong>
    </span>
  </p>
  <p>
    <span>Avoid using HTTP GET in the query string.&amp;nbsp; If your application uses this technique for transferring sensitive data to server you'll see a URLs such as the following in your address bar as well as in your browser history:</span>
  </p>
  <p />
  <pre>                http://www.MySite.com/results.asp?queryParam=SensitiveData&amp;queryParam2=MoreSensitiveData
              </pre>
  <p />
  <h1>How to Fix</h1>
  <p>If a user is submitting sensitive data, they should submit it as a form field via an HTTP POST, not in the query string.&amp;nbsp;&amp;nbsp;Whenever possible, avoid the problem entirely—do not send sensitive data on a round trip to the user unless they need to edit the data.&amp;nbsp; Instead, store sensitive session data on the server side.&amp;nbsp; If sensitive data must be sent through the user, use an encrypted ViewState instead of a query string parameter.</p>
  <p>If your application is using query string to communicate sensitive data to the server, use the following steps to fix the issue:</p>
  <ol>
    <li>
      <p>Use HTTP POST (form submission) instead of HTTP GET for sensitive data provided by the user.&amp;nbsp; This will ensure that data is not logged by web proxies, the web server's logs, or browser histories. </p>
    </li>
    <li>
      <p>Store sensitive data server side instead of repeatedly passing it as a query string parameter.&amp;nbsp; The best way to keep sensitive information safe is to leave it somewhere inaccessible. </p>
    </li>
    <li>
      <p>If sensitive data must be sent through the user—during a server transition, for instance—send it via an encrypted ViewState instead of a query string parameter.&amp;nbsp; ViewStates are designed to support integrity and confidentiality, as needed, and are the best way of ensuring that sensitive data is not tampered with or disclosed when it is sent past the user. </p>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>An ASP.NET application requests the user to enter their social security number to gain access to financial information. Instead of using a form submit to post this information to the server the application uses an HTTP GET and places the social security number in the query string.</p>
  <pre>                http://www.BankSite.com/results.asp?SocialSecurityNum=123001234
              </pre>
  <p>The problem with this implementation is that sensitive informaiton (social security number) is persisted in browser history, in the cache and is not being sent over SSL so it is not protected on the wire.</p>
  <h1>Solution Example</h1>
  <p>An ASP.NET application requests the user to enter their social security number to gain access to financial information. The application uses a form post over SSL to send the information to the server</p>
  <pre>                POST results.asp?SocialSecurityNum=123001234
              </pre>
  <p>Since a POST is used instead of a GET, the information is not persisted in the browser history or cache. Using SSL protects the sensitive information on the wire.</p>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>