<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="1054577588" Content_Hash="1307533231">
  <Metadata>
    <Id>21cc9434-6945-41e1-8f85-c49bbe6ddff1</Id>
    <Id_History>9031f577-80b0-4a2e-9652-7b470439a0df,</Id_History>
    <Library_Id>c4b9cb6a-4561-4451-9b6c-4e59d73584f6</Library_Id>
    <Title>Access to the Credential Store Is Limited</Title>
    <Category>Authentication</Category>
    <Phase>Implementation</Phase>
    <Technology>Java</Technology>
    <Type>Checklist Item</Type>
    <DirectLink>Access to the Credential Store Is Limited</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>What to Check For</h1>
  <p>Ensure that access to the credential store is limited to administrators with the correct privileges. </p>
  <h1>Why</h1>
  <p>Unauthorized access to the credential store can lead to users' credentials being overwritten; therefore, allowing the attacker to gain access to application resources without obtaining valid credentials prior to the attack.</p>
  <h1>How to Check</h1>
  <p>Follow these steps to ensure that the credential store is properly secured: </p>
  <ol>
    <li>
      <p>
        <strong>Identify all routines that access the store. </strong>Locate all routines within your application that access the credential store. Such routines include:</p>
      <ul>
        <li>Authenticating users </li>
        <li>Creating users </li>
        <li>Modifying users </li>
        <li>Changing user passwords</li>
      </ul>
    </li>
    <li>
      <p>
        <strong>Verify that credentials for accessing the store are secured. </strong>Ensure that your application's access credentials and connection strings are not hard-coded into your application's code base. </p>
      <ul>
        <li>If your application <strong>uses a database</strong> for its credential repository, ensure that access credentials and connection strings are secured properly. </li>
        <li>If your application <strong>does not use a database</strong> for its credential repository, verify that only the appropriate components of your application are able to access the credential store.<br /><br />Example of how <strong>not</strong> to handle access to the credential store: </li>
      </ul>
      <p />
      <blockquote>
        <pre>// The application discloses the credentials necessary for accessing the user database<br />DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());<br />Connection cn = DriverManager.getConnection("jdbc:oracle:thin:@testbox:1521:orcl2", "myapp", "pass"); </pre>
      </blockquote>
    </li>
    <li>
      <p>
        <strong>Check the access controls for your credential store.</strong> Ensure that your application's credential store has the appropriate security in place. For instance, if your application uses a database for its credential store, verify that the database server is secured properly.</p>
    </li>
  </ol>
  <ol>
  </ol>
  <h1>How to Fix</h1>
  <p>Follow these steps to limit the access to the credential store: </p>
  <ol>
    <li>
      <p>
        <strong>Avoid disclosing the location of the store. </strong>Do not disclose the location of the store within your application. Do not let&amp;nbsp;regular application users know where the store is located. </p>
    </li>
    <li>
      <p>
        <strong>Secure credentials required for accessing the store. </strong>Store your credentials within a configuration file and encrypt them. Place the encryption key within a keystore that is encrypted using a local account password.</p>
    </li>
    <li>
      <p>
        <strong>Restrict access to repository. </strong>Limit the number of users that can access the store. If it is a file on the local file system, set the appropriate permissions to restrict the read/write access. If it is a database, restrict the accounts that can access the database server.</p>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>The following code authenticates a user based on their credentials. Because the code discloses the credentials to the user database, anybody with access to the code also has access to the credential store. </p>
  <pre>public boolean validateUser(String user, char[] pass)<br />{<br />      boolean valid;<br />      Connection cn;<br /><br />      // Prepare credentials before querying the credential store<br />      ...<br />      try<br />      {<br />            // The application discloses the credentials necessary for<br />            // accessing the user database<br />            DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());<br />            cn = DriverManager.getConnection("jdbc:oracle:thin:@testbox:1521:orcl2",<br />                                             "myapp", "pass");<br />            // Query the credential store and perform the rest<br />            // of the authentication steps<br />            ...<br />      }<br />      catch (SQLException se)<br />      {<br />            // Add the appropriate logging and exception handling mechanisms<br />            return false;<br />      }<br /><br />      return valid;<br />}</pre>
  <h1>Solution Example</h1>
  <p>The following code authenticates a user based on their credentials. The code relies on other parts of the application to handle database connectivity. Therefore, the code does not reveal the application's credentials to the credential store. </p>
  <pre>public boolean validateUser(String user, char[] pass)<br />{<br />      boolean valid;<br />      // Prepare credentials before querying the credential store<br />      ...<br />      try<br />      {<br />            // The credentials to the application's user database<br />            // are not hard-coded in the authentication routine<br />            cn = MyApp.getDBConnection();<br />            // Query the credential store and perform the rest<br />            // of the authentication steps<br />            ...<br />      }<br />      catch (SQLException se)<br />      {<br />            // Add the appropriate logging and exception handling mechanisms<br />            return false;<br />      }<br />      return valid;<br />}</pre>
  <h1>Authentication Guidelines</h1>
  <ul>
    <li>
      <a href="/article/989e27ec-ffdf-4006-88bd-1c09fc991a28">Centralize Authentication Controls</a>
    </li>
    <li>
      <a href="/article/d3a69ef7-2c63-41bc-81e4-803b0ea199d8">Use Server-side Authentication</a>
    </li>
    <li>
      <a href="/article/38d12903-9c3b-46bd-9f5e-f223c3272624">Make Sure Authentication Controls Fail Securely</a>
    </li>
    <li>
      <a href="/article/84fd606b-e2f2-4c48-9c6e-6b5e780c6163">Force Re-authentication When Executing Critical Functionality</a>
    </li>
    <li>
      <a href="/article/c566cabe-2463-4d24-8763-22e8468d167e">Validate Usernames Before Processing Them</a>
    </li>
    <li>
      <a href="/article/7ba2d49c-ff53-4755-97ae-0efcb0aa9c22">Lock Accounts After Consecutive Failed Login Attempts</a>
    </li>
    <li>
      <a href="/article/4b5b1f05-aa9a-4ebc-8b2e-3cecabed03e1">Enforce Strong Passwords</a>
    </li>
    <li>
      <a href="/article/ea25af24-8eca-45ad-9f41-94bad8880247">Force Password Renewal</a>
    </li>
    <li>
      <a href="/article/c7825052-f281-4ac8-a786-41b776219af6">Mask All Password Fields</a>
    </li>
    <li>
      <a href="/article/c4d9269f-9157-4919-952c-f0d14ccd7f60">Verify the Application's Authenticity to the User</a>
    </li>
    <li>
      <a href="/article/b4f83e8e-3223-4e49-bc9c-56c8c7268582">Place Logout Links on All Pages that Require Authentication</a>
    </li>
    <li>
      <a href="/article/ff95311e-797f-417f-bd0b-e6cf610f706c">Do Not Leave Passwords in Memory</a>
    </li>
    <li>
      <a href="/article/bcf8adb4-8186-4b97-b490-4fa33f506bfd">Limit Access to the Credential Store</a>
    </li>
    <li>
      <a href="/article/0dba2e1f-7d49-4d91-bc93-ad85480f784a">Consider Using JAAS for Authentication</a>
    </li>
    <li>
      <a href="/article/9cf8aed6-22a5-49c1-a0ce-1d8e5366bebf">Consider Using Two Factor Authentication</a>
    </li>
  </ul>
  <h1>Authentication Checklists</h1>
  <ul>
    <li>
      <a href="/article/4e431329-73aa-41f7-b397-9b7e26294a4c">Authentication Controls Are Centralized</a>
    </li>
    <li>
      <a href="/article/b103207d-73e3-4964-9a00-2b15c3e012b8">Server-side Authentication Is Used</a>
    </li>
    <li>
      <a href="/article/ded06846-ad7f-4044-87d2-8bbb6b885713">Authentication Controls Fail Securely</a>
    </li>
    <li>
      <a href="/article/df093ee3-ad7b-4191-935c-8bb0cad78d98">Re-authentication Is Enforced When Executing Critical Functionality</a>
    </li>
    <li>
      <a href="/article/f8586505-72f9-4c14-a365-3e5049e5ca57">Usernames Are Validated Before Use</a>
    </li>
    <li>
      <a href="/article/61e0e2b4-2f09-429a-b72f-f8933f2fa9b6">Accounts Are Locked After Consecutive Failed Login Attempts</a>
    </li>
    <li>
      <a href="/article/7401862f-ae81-4f31-9340-981b0ec5a854">Strong Passwords Are Enforced</a>
    </li>
    <li>
      <a href="/article/12889762-1d65-4b7d-a90a-58ff6c23d1e4">Password Renewal Is Enforced</a>
    </li>
    <li>
      <a href="/article/09f994c9-a401-404c-bdc9-210038eba658">All Password Fields Are Masked</a>
    </li>
    <li>
      <a href="/article/35851f18-13a0-4bf8-88cc-d35c371cfb12">The Application's Authenticity Is Verified to the User</a>
    </li>
    <li>
      <a href="/article/493e0e57-254a-4697-8fa1-c93e706d416d">All Pages that Use Authentication Have Logout Links</a>
    </li>
    <li>
      <a href="/article/55488f2e-ed85-4f0f-9f83-1d90a5d10bd0">Passwords Are Not Left in Memory</a>
    </li>
    <li>
      <a href="/article/9031f577-80b0-4a2e-9652-7b470439a0df">Access to the Credential Store Is Limited</a>
    </li>
  </ul>
  <h1>Authentication Testing</h1>
  <ul>
    <li>
      <a href="/article/f32846cf-35f6-40fe-8517-f0ac8a415383">How to Test for Account Lockout Bugs in Java</a>
    </li>
  </ul>]]></Data>
  </Content>
</TeamMentor_Article>