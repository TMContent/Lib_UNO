<?xml version="1.0"?>
<TeamMentor_Article Metadata_Hash="-1039328312" Content_Hash="1676342340">
  <Metadata>
    <Id>bfac7216-6820-4c00-ac05-9da3c0720a69</Id>
    <Id_History>507464df-06a1-48df-ae04-f89dc57bf0e7,</Id_History>
    <Library_Id>ea854894-8e16-46c8-9c61-737ef46d7e82</Library_Id>
    <Title>Global Error Handlers Are Used to Catch Unhandled Exceptions</Title>
    <Category>Error and Exception Management</Category>
    <Phase>Implementation</Phase>
    <Technology>ASP.NET 2.0</Technology>
    <Type>Checklist Item</Type>
    <DirectLink>Global Error Handlers Are Used to Catch Unhandled Exceptions</DirectLink>
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>J.D. Meier, Alex Mackman, Blaine Wastell, Prashant Bansode, Andy Wigley, Kishore Gopalan</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>Applies to</h1>
  <ul>
    <li>ASP.NET 2.0</li>
  </ul>
  <h1>What to Check For</h1>
  <p>Check to ensure a global error handler has been defined for your application to catch any exceptions that are not handled in the code.</p>
  <h1>Why</h1>
  <p>Even if structured exception handling is used, not all application code will be wrapped in a Try/Catch/Finally block.&amp;nbsp; A global exception handler will ensure that these unhandled exceptions don't result in an error message to the client that will disclose internal application details.</p>
  <h1>How to Check</h1>
  <p>Check Global.asax the ensure an application-level global error handler has been defined.&amp;nbsp; Check to ensure Application_Error has been overriden and implemented. The error handler will look similar to the following code:</p>
  <pre>&lt;%@ Application Language="C#" %&gt;<br /> &lt;%@ Import Namespace="System.Diagnostics" %&gt;<br />  &lt;script language="C#" runat="server"&gt;<br /> void Application_Error(object sender, EventArgs e) {<br />    //get reference to the source of the exception chain<br />    Exception ex = Server.GetLastError().GetBaseException();<br />     // log the details of the exception and page state to the<br />    // event log.<br />    EventLog.WriteEntry("My Web Application",<br />      "MESSAGE: " + ex.Message +<br />       "\nSOURCE: " + ex.Source,<br />       EventLogEntryType.Error);<br />     // Optional e-mail or other notification here...<br /> }<br /> &lt;/script&gt;&amp;nbsp;</pre>
  <h1>How to Fix</h1>
  <p>Define an application-level global error handler in Global.asax to catch any exceptions that are not handled in code. Do this to avoid accidentally returning detailed error information to the client. You should log all exceptions in the event log to record them for tracking and later analysis. Use code similar to the following.</p>
  <pre>&lt;%@ Application Language="C#" %&gt;<br /> &lt;%@ Import Namespace="System.Diagnostics" %&gt;<br />  &lt;script language="C#" runat="server"&gt;<br /> void Application_Error(object sender, EventArgs e) {<br />    //get reference to the source of the exception chain<br />    Exception ex = Server.GetLastError().GetBaseException();<br />     // log the details of the exception and page state to the<br />    // event log.<br />    EventLog.WriteEntry("My Web Application",<br />      "MESSAGE: " + ex.Message +<br />       "\nSOURCE: " + ex.Source,<br />       EventLogEntryType.Error);<br />     // Optional e-mail or other notification here...<br /> }<br /> &lt;/script&gt;</pre>
  <h1>Problem Example</h1>
  <p>An ASP.NET application has code to connect to a SQL database.&amp;nbsp; However, the application does not have a generic error handler specified.&amp;nbsp; As a result, when the connection times out application details are revealed to the client in the exception.</p>
  <p>
    <strong>Description: </strong>An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. <br /><br /><b>Exception Details: </b>System.Data.SqlClient.SqlException: An error has occurred while establishing a connection to the server. &amp;nbsp;When connecting to SQL Server 2005, this failure may be caused by the fact that under the default settings SQL Server does not allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)<br /><br /><b>Source Error:</b><br /><br /></p>
  <table>
    <tbody>
      <tr>
        <td>
          <pre>
            <br />Line 216:<br />Line 217:            if (conn.State != ConnectionState.Open)<br />Line 218:                conn.Open();<br />Line 219:<br />Line 220:            cmd.Connection = conn;</pre>
        </td>
      </tr>
    </tbody>
  </table>
  <p />
  <h1>Solution Example</h1>
  <p>An ASP.NET application has code to connect to a SQL database.&amp;nbsp; It has defined&amp;nbsp;an application-level global error handler to trap and log all unhandled exceptions.&amp;nbsp; This allows the application to present a generic error message to the client while logging more detailed information to the server.</p>
  <br />
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>]]></Data>
  </Content>
</TeamMentor_Article>